<!DOCTYPE html>
<html lang="it">
<head>
  <meta charset="UTF-8">
  <title>Piano Alimentare Settimanale Giornaliero</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="icon" type="image/png" sizes="192x192" href="icon-192.png">
  <link rel="icon" type="image/png" sizes="512x512" href="icon-512.png">
  <link rel="apple-touch-icon" sizes="180x180" href="icon-180.png">
  <link rel="manifest" href="site_goodfood.webmanifest">
  <meta name="mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-capable" content="yes">

  <style>
    :root {
      --primary: #156fa2;
      --primary-light: #1976d2;
      --accent: #0077b6;
      --bg: #f8f9fa;
      --section-bg: #fff;
      --section-shadow: 0 2px 8px #eee;
      --radius: 10px;
      --nav-bg: #e3e6ea;
      --nav-hover: #b8d2f3;
      --note-bg: #e6f3ff;
      --note-border: #156fa2;
      --text: #222;
      --highlight: #fffeb3;
      --toast-bg: #fffbea;
      --toast-border: #ffe066;
      --toast-shadow: 0 6px 24px #e9c74a66;
      --toast-info: #f6c700;
    }
    html, body {
      margin: 0;
      padding: 0;
      background: var(--bg);
      color: var(--text);
      font-family: 'Segoe UI', Arial, sans-serif;
      font-size: 18px;
      line-height: 1.55;
    }
    body {
      padding-top: 0em;
      padding-bottom: 10em;
      padding-left: 4em;
      padding-right: 4em;
    }
    .nav {
      margin: 2em 0 2em 0;
      padding: 0;
      display: flex;
      flex-wrap: wrap;
      gap: 0.7em;
      justify-content: flex-start;
      font-size: 1em;
    }
    .nav a {
      background: var(--nav-bg);
      color: var(--accent);
      padding: 0.5em 1em;
      border-radius: 6px;
      text-decoration: none;
      transition: background 0.2s;
      font-weight: 500;
      font-size: 1em;
    }
    .nav a:hover, .nav a:focus {
      background: var(--nav-hover);
      color: var(--primary-light);
      outline: none;
    }

    /* Personalizzazione colori specifici per Note e Sintesi calorica */
    .nav a[href="#note"] {
      background: var(--note-bg);
      color: var(--note-border);
      border: 1px solid var(--note-border);
    }

    .nav a[href="#note"]:hover, .nav a[href="#note"]:focus {
      background: #d4edff;
      color: #0d4a73;
    }

    .nav a[href="#sintesi-calorica"] {
      background: #fff4e0;
      color: #ff9800;
      border: 1px solid #ff9800;
    }

    .nav a[href="#sintesi-calorica"]:hover, .nav a[href="#sintesi-calorica"]:focus {
      background: #ffecb3;
      color: #f57500;
    }

    section {
      margin-bottom: 2em;
      background: var(--section-bg);
      padding: 1em 2.5em 1.5em 2.5em;
      border-radius: var(--radius);
      box-shadow: var(--section-shadow);
      max-width: 700px;
      margin-left: auto;
      margin-right: auto;
    }
    h1 {
      margin-top: 0.1em;
      margin-bottom: 0.7em;
      font-size: 2em;
      color: var(--primary);
      text-align: left;
      letter-spacing: 0.01em;
    }
    h2 {
      color: var(--primary-light);
      margin-bottom: 0.2em;
      margin-top: 1.4em;
      font-size: 1.18em;
      font-weight: 600;
      transition: background 0.25s;
    }
    p {
      margin-top: 0.2em;
      margin-bottom: 0.9em;
      transition: background 0.25s;
    }
    ul.menu-elenco {
      margin-top: 0.2em;
      margin-bottom: 0.9em;
      margin-left: 1.2em;
      padding-left: 1em;
    }
    .note {
      margin: 2.5em auto 1em auto;
      background: var(--note-bg);
      padding: 1em 1.2em;
      border-radius: 8px;
      border-left: 4px solid var(--note-border);
      max-width: 700px;
      font-size: 1em;
    }
    .note ul {
      margin: 0.5em 0 0 1.2em;
      padding: 0;
    }

    /* Header styles */
    .header {
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 1em;
      margin: 1.5em 0 1em 0;
      padding: 1em 0;
    }
    .logo {
      margin-bottom: 0;
    }
    .logo-img {
      width: 80px;
      height: 80px;
      border-radius: 50%;
      box-shadow: 0 4px 12px rgba(21,111,162,0.15);
    }
    .main-title {
      font-size: 2.5em;
      color: var(--primary);
      margin: 0;
      font-weight: 700;
      letter-spacing: 0.02em;
    }
    
    @media (max-width: 600px) {
      .logo-img {
        width: 60px;
        height: 60px;
      }
      .main-title {
        font-size: 1.8em;
      }
      .header {
        margin: 1em 0 0.8em 0;
        padding: 0.8em 0;
        gap: 0.7em;
      }
    }
    
    /* Toast message box */
    #info-toast {
      display: none;
      position: fixed;
      top: 30%;
      right: 0;
      left: 0;
      margin-left: auto;
      margin-right: auto;
      min-width: 220px;
      max-width: 380px;
      z-index: 2000;
      background: var(--toast-bg);
      color: #5a5a26;
      border: 1.5px solid var(--toast-border);
      box-shadow: var(--toast-shadow);
      border-radius: 10px;
      padding: 1.1em 1.6em 1.1em 1.1em;
      font-size: 1.07em;
      display: flex;
      align-items: flex-start;
      gap: 0.7em;
      animation: fadein 0.6s;
      /* aggiunta: spazio orizzontale rispetto ai lati */
      margin-top: 24px;
      margin-bottom: 0;
      /* spazio laterale su schermi piccoli */
      box-sizing: border-box;
    }
    @media (max-width: 600px) {
      #info-toast {
        min-width: 120px;
        max-width: 98vw;
        left: 2vw;
        right: 2vw;
        padding: 0.7em 1em 0.7em 0.7em;
        font-size: 1.05em;
      }
    }


    .toast-icon {
      min-width: 48px;
      width: 48px;
      flex-shrink: 0;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    .toast-icon svg {
      width: 24px;
      height: 24px;
      display: block;
    }

    @media (max-width: 600px) {
      #info-toast {
        min-width: 120px;
        max-width: 98vw;
        left: 2vw;
        right: 2vw;
        padding: 0.7em 1em 0.7em 0.6em; /* più spazio a sinistra */
        font-size: 1.05em;
      }
      .toast-icon {
        min-width: 48px;
        width: 48px;
      }
      .toast-icon svg {
        width: 18px;
        height: 18px;
      }
    }
    @media (max-width: 400px) {
      #info-toast {
        font-size: 1.06em;
        padding-left: 0.4em;
      }
      .toast-icon {
        min-width: 48px;
        width: 48px;
      }
      .toast-icon svg {
        width: 24px;
        height: 24px;
      }
    }



    /* Evidenziato in giallo */
    .highlight {
      background: var(--highlight) !important;
      border-radius: 7px;
      box-shadow: 0 2px 8px #ffe46033;
      transition: background 0.25s;
    }
    #toTopBtn {
      position: fixed;
      bottom: 32px; /* Base */
      right: 32px;
      width: 56px;
      height: 56px;
      border: none;
      border-radius: 50%;
      background: var(--primary);
      color: white;
      box-shadow: 0 4px 12px rgba(21,111,162,0.18);
      cursor: pointer;
      z-index: 1000;
      transition: background 0.18s, box-shadow 0.18s, opacity 0.18s;
      opacity: 0.88;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 2em;
    }
    #toTopBtn:hover, #toTopBtn:focus {
      background: var(--primary-light);
      box-shadow: 0 8px 24px rgba(21,111,162,0.22);
      opacity: 1;
      outline: none;
    }
    #toTopBtn svg {
      display: block;
      width: 28px;
      height: 28px;
    }

        
  #nowBtn {
    position: fixed;
    bottom: 106px; /* 32 + 56 + 18 = 106px */
    right: 32px;
    width: 56px;
    height: 56px;
    border: none;
    border-radius: 50%;
    background: var(--highlight);
    color: #5a5a26;
    box-shadow: 0 4px 12px rgba(255, 228, 96, 0.4);
    cursor: pointer;
    z-index: 1000;
    transition: background 0.18s, box-shadow 0.18s, opacity 0.18s, transform 0.18s;
    opacity: 0.88;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 1.8em;
    font-weight: bold;
  }

  #waterToggleBtn {
    position: fixed;
    bottom: 180px; /* 106 + 56 + 18 = 180px */
    right: 32px;
    width: 56px;
    height: 56px;
    border: none;
    border-radius: 50%;
    background: #4a90e2;
    color: white;
    box-shadow: 0 4px 12px rgba(74, 144, 226, 0.4);
    cursor: pointer;
    z-index: 1000;
    transition: background 0.18s, box-shadow 0.18s, opacity 0.18s, transform 0.18s;
    opacity: 0.88;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 1.8em;
    font-weight: bold;
  }
    
    #nowBtn:hover, #nowBtn:focus {
      background: #ffe066; /* Giallo più intenso al hover */
      box-shadow: 0 8px 24px rgba(255, 228, 96, 0.6);
      opacity: 1;
      transform: scale(1.05);
      outline: none;
    }
    
    #nowBtn svg {
      display: block;
      width: 24px;
      height: 24px;
    }
    
    #nowBtn:focus-visible {
      outline: 2px solid #f6c700;
      outline-offset: 2px;
    }
    
    @media (max-width: 600px) {
      #toTopBtn {
        width: 42px;
        height: 42px;
        right: 10px;
        bottom: 10px; /* Base per mobile */
        font-size: 1.3em;
      }
      
      #nowBtn {
        width: 42px;
        height: 42px;
        bottom: 67px; /* 10 + 42 + 15 = 67px */
        right: 10px;
        font-size: 1.3em;
      }
      
      #nowBtn svg {
        width: 18px;
        height: 18px;
      }
    }

    #waterToggleBtn {
      position: fixed;
      bottom: 168px; /* Posizionato sopra il pulsante nowBtn */
      right: 32px;
      width: 56px;
      height: 56px;
      border: none;
      border-radius: 50%;
      background: #4a90e2; /* Stesso blu del bordo del bicchiere */
      color: white;
      box-shadow: 0 4px 12px rgba(74, 144, 226, 0.4);
      cursor: pointer;
      z-index: 1000;
      transition: background 0.18s, box-shadow 0.18s, opacity 0.18s, transform 0.18s;
      opacity: 0.88;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 1.8em;
      font-weight: bold;
    }
    
    #waterToggleBtn:hover, #waterToggleBtn:focus {
      background: #3a7bc8; /* Blu più scuro al hover */
      box-shadow: 0 8px 24px rgba(74, 144, 226, 0.6);
      opacity: 1;
      transform: scale(1.05);
      outline: none;
    }
    
    #waterToggleBtn svg {
      display: block;
      width: 24px;
      height: 24px;
    }
    
    #waterToggleBtn:focus-visible {
      outline: 2px solid #4a90e2;
      outline-offset: 2px;
    }
    
    @media (max-width: 600px) {
      #waterToggleBtn {
        width: 42px;
        height: 42px;
        bottom: 124px; /* 67 + 42 + 15 = 124px */
        right: 10px;
        font-size: 1.3em;
      }
      
      #waterToggleBtn svg {
        width: 18px;
        height: 18px;
      }
    }
    
    /* Nascondi elementi quando in fullscreen */
    body.fullscreen-active #toTopBtn,
    body.fullscreen-active #nowBtn,
    body.fullscreen-active #waterToggleBtn,
    body.fullscreen-active #waterControls {
      display: none !important;
    }
    
    /* Nascondi elementi quando in fullscreen */
    body.fullscreen-active #toTopBtn,
    body.fullscreen-active #nowBtn,
    body.fullscreen-active #waterControls {
      display: none !important;
    }


    @media (max-width: 900px) {
      section, .note {
        max-width: 98vw;
        padding-left: 3vw;
        padding-right: 3vw;
      }
      .nav {
        gap: 0.45em;
        font-size: 0.98em;
      }
      body {
        padding-left: 4vw;
        padding-right: 4vw;
      }
    }
    @media (max-width: 600px) {
      html, body {
        font-size: 16px;
      }
      .nav {
        gap: 0.4em;
        font-size: 0.96em;
        margin-top: 1.1em;
        margin-bottom: 1.1em;
      }
      h1 {
        font-size: 1.28em;
        margin-top: 0.07em;
        margin-bottom: 0.6em;
      }
      h2 {
        font-size: 1.07em;
        margin-top: 1em;
        margin-bottom: 0.11em;
      }
      section, .note {
        padding: 1em 0.8em;
        border-radius: 7px;
        max-width: 100vw;
      }
      #toTopBtn {
        width: 42px;
        height: 42px;
        right: 10px;
        bottom: 10px;
        font-size: 1.3em;
      }
      #toTopBtn svg {
        width: 18px;
        height: 18px;
      }
      body {
        padding-left: 4vw;
        padding-right: 4vw;
      }
    }
    .nav a:focus-visible, #toTopBtn:focus-visible {
      outline: 2px solid #1976d2;
      outline-offset: 2px;
    }

    #waterGlass {
      position: fixed;
      bottom: 32px;
      left: 32px;
      width: 120px;
      height: 168px;
      z-index: 1000;
      cursor: pointer;
      transition: transform 0.2s ease;
    }
    #waterGlass:hover {
      transform: scale(1.1);
    }
    @media (max-width: 600px) {
      #waterGlass {
        width: 96px;
        height: 134px;
        bottom: 10px;
        left: 10px;
      }
    }




    #waterControls {
      position: fixed;
      bottom: 32px;
      left: 32px;
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 8px;
      z-index: 1000;
      display: none;
    }

    .water-percentage {
      position: absolute;
      top: 38px;
      left: 50%;
      transform: translateX(-50%);
      font-size: 0.8em;
      color: var(--primary);
      font-weight: 700;
      background: rgba(255, 255, 255, 0.95);
      padding: 2px 6px;
      border-radius: 4px;
      box-shadow: 0 1px 3px rgba(0,0,0,0.15);
      z-index: 1002;
      pointer-events: none;
      text-align: center;
      line-height: 1.2;
    }

    .water-liters {
      font-size: 0.85em;
      color: var(--primary-light);
      font-weight: 600;
      margin-top: 1px;
    }
    
    #waterGlass {
      width: 120px;
      height: 168px;
      cursor: pointer;
      transition: transform 0.2s ease;
      position: relative;
    }
    #waterGlass:hover {
      transform: scale(1.1);
    }
    
    .water-buttons {
      display: flex;
      gap: 8px;
      padding-left: 65px;
      margin-top: -27px;
    }
    
    .water-btn {
      width: 36px;
      height: 36px;
      border: none;
      border-radius: 50%;
      background: var(--primary);
      color: white;
      box-shadow: 0 4px 12px rgba(21,111,162,0.18);
      cursor: pointer;
      transition: background 0.18s, box-shadow 0.18s, opacity 0.18s;
      opacity: 0.88;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 1.5em;
      font-weight: bold;
    }
    
    .water-btn:hover, .water-btn:focus {
      background: var(--primary-light);
      box-shadow: 0 8px 24px rgba(21,111,162,0.22);
      opacity: 1;
      outline: none;
    }
    
    .water-btn:focus-visible {
      outline: 2px solid #1976d2;
      outline-offset: 2px;
    }
    
    @media (max-width: 600px) {
      #waterControls {
        bottom: 10px;
        left: 10px;
        gap: 6px;
        display: none;
      }
      .water-percentage {
        top: 33px;
        font-size: 0.75em;
        padding: 1px 4px;
      }
      .water-liters {
        font-size: 1em;
      }
      #waterGlass {
        width: 96px;
        height: 134px;
      }
      .water-btn {
        width: 30px;
        height: 30px;
        font-size: 1.2em;
      }
      .water-buttons {
        padding-left: 25px;
        gap: 10px;
        margin-top: -7px;
      }
    }


        /* Animazione coriandoli */
    .confetti-container {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      pointer-events: none;
      z-index: 9999;
      overflow: hidden;
    }
    
    .confetti {
      position: absolute;
      width: 10px;
      height: 10px;
      border-radius: 50%;
      animation: confetti-fall 7s linear infinite;
    }
    
    .confetti:nth-child(odd) {
      background: #ff6b6b;
      animation-delay: -0.5s;
    }
    
    .confetti:nth-child(even) {
      background: #4ecdc4;
      animation-delay: -1s;
    }
    
    .confetti:nth-child(3n) {
      background: #45b7d1;
      width: 8px;
      height: 8px;
      animation-delay: -1.5s;
    }
    
    .confetti:nth-child(4n) {
      background: #f9ca24;
      width: 12px;
      height: 12px;
      animation-delay: -2s;
    }
    
    .confetti:nth-child(5n) {
      background: #6c5ce7;
      animation-delay: -2.5s;
    }
    
    .confetti:nth-child(6n) {
      background: #fd79a8;
      width: 6px;
      height: 6px;
      animation-delay: -3s;
    }
    
    @keyframes confetti-fall {
      0% {
        transform: translateY(-100vh) rotate(0deg);
        opacity: 1;
      }
      100% {
        transform: translateY(100vh) rotate(720deg);
        opacity: 0;
      }
    }
    
    .confetti-square {
      border-radius: 0;
      transform: rotate(45deg);
    }
    
    .confetti-triangle {
      width: 0;
      height: 0;
      border-left: 5px solid transparent;
      border-right: 5px solid transparent;
      border-bottom: 10px solid;
      border-radius: 0;
    }
    


    /* Toast message box verde per il successo */
    #success-toast {
      display: none;
      position: fixed;
      top: 30%;
      right: 0;
      left: 0;
      margin-left: auto;
      margin-right: auto;
      min-width: 220px;
      max-width: 380px;
      z-index: 2000;
      background: #e8f5e8;
      color: #2e5d2e;
      border: 1.5px solid #4caf50;
      box-shadow: 0 6px 24px rgba(76, 175, 80, 0.3);
      border-radius: 10px;
      padding: 1.1em 1.6em 1.1em 1.1em;
      font-size: 1.07em;
      display: flex;
      align-items: flex-start;
      gap: 0.7em;
      animation: fadein 0.6s;
      margin-top: 24px;
      margin-bottom: 0;
      box-sizing: border-box;
    }
    
    @media (max-width: 600px) {
      #success-toast {
        min-width: 120px;
        max-width: 98vw;
        left: 2vw;
        right: 2vw;
        padding: 0.7em 1em 0.7em 0.6em;
        font-size: 1.05em;
      }
    }
    
    @media (max-width: 400px) {
      #success-toast {
        font-size: 1.06em;
        padding-left: 0.4em;
      }
    }


    /* Animazioni per lo swipe */
    .slide-left {
      animation: slideLeft 0.3s ease-out;
    }
    
    .slide-right {
      animation: slideRight 0.3s ease-out;
    }
    
    @keyframes slideLeft {
      0% { transform: translateX(100%); opacity: 0; }
      100% { transform: translateX(0); opacity: 1; }
    }
    
    @keyframes slideRight {
      0% { transform: translateX(-100%); opacity: 0; }
      100% { transform: translateX(0); opacity: 1; }
    }

    /* Toast per lo swipe */
    #swipe-toast {
      position: fixed;
      bottom: 80px;
      left: 50%;
      transform: translateX(-50%);
      background: rgba(0, 0, 0, 0.8);
      color: white;
      padding: 8px 16px;
      border-radius: 20px;
      font-size: 0.9em;
      z-index: 3000;
      opacity: 0;
      transition: opacity 0.3s;
      pointer-events: none;
      font-weight: 600;
    }
    
    #swipe-toast.show {
      opacity: 1;
    }
    
    @media (max-width: 600px) {
      #swipe-toast {
        bottom: 60px;
        font-size: 0.85em;
        padding: 6px 12px;
      }
    }


    /* Stile per l'icona della lista della spesa */
    .shopping-icon {
      color: #2e7d32;
      margin-right: 0.3em;
      flex-shrink: 0;
    }

    /* Rimuovi il bordo superiore dalla sezione espandibile */
    .lista-spesa .expandable-section {
      border-top: none;
      padding-top: 0;
    }

    /* Aggiusta lo stile del toggle per includere l'icona */
    .lista-spesa .expand-toggle {
      justify-content: flex-start;
      align-items: center;
      width: 100%;
      text-align: left;
    }


    /* Sintesi calorica box stile arancione */
    .sintesi-calorica {
      margin: 2.5em auto 1em auto;
      background: #fff4e0;
      padding: 1em 1.2em;
      border-radius: 8px;
      border-left: 4px solid #ff9800;
      max-width: 700px;
      font-size: 1em;
      color: #a65c00;
      box-shadow: 0 2px 8px #ffe0b266;
    }
    .sintesi-calorica strong {
      color: #ff9800;
    }
    @media (max-width: 900px) {
      .sintesi-calorica {
        max-width: 98vw;
        padding-left: 3vw;
        padding-right: 3vw;
      }
    }
    @media (max-width: 600px) {
      .sintesi-calorica {
        padding: 1em 0.8em;
        border-radius: 7px;
        max-width: 100vw;
      }
    }

    /* Stili per la sezione espandibile */
    .expandable-section {
      border-top: 1px solid #ffcc80;
      padding-top: 1em;
    }

    .expand-toggle {
      background: none;
      border: none;
      color: #ff9800;
      cursor: pointer;
      display: flex;
      align-items: center;
      gap: 0.5em;
      font-size: 0.95em;
      font-weight: 600;
      padding: 0.5em 0;
      transition: color 0.2s;
    }

    .expand-toggle:hover {
      color: #f57500;
    }

    .toggle-arrow {
      transition: transform 0.2s ease;
    }

    .expand-toggle[aria-expanded="true"] .toggle-arrow {
      transform: rotate(180deg);
    }

    .details-content {
      margin-top: 0.5em;
      animation: slideDown 0.3s ease-out;
    }

    @keyframes slideDown {
      from {
        opacity: 0;
        max-height: 0;
      }
      to {
        opacity: 1;
        max-height: 1000px;
      }
    }

    .details-content h4 {
      margin-top: 1.2em;
      margin-bottom: 0.6em;
      font-size: 1.1em;
    }

    .details-content h4:first-child {
      margin-top: 0;
    }


    /* Personalizzazione colore per Lista della spesa */
    .nav a[href="#lista-spesa"] {
      background: #e8f5e8;
      color: #2e7d32;
      border: 1px solid #4caf50;
    }

    .nav a[href="#lista-spesa"]:hover, .nav a[href="#lista-spesa"]:focus {
      background: #c8e6c9;
      color: #1b5e20;
    }

    /* Lista della spesa box stile verde */
    .lista-spesa {
      margin: 1em auto 1em auto;
      background: #e8f5e8;
      padding: 1em 1.2em;
      border-radius: 8px;
      border-left: 4px solid #4caf50;
      max-width: 700px;
      font-size: 1em;
      color: #2e5d2e;
      box-shadow: 0 2px 8px rgba(76, 175, 80, 0.15);
    }
    .lista-spesa strong {
      color: #2e7d32;
    }
    @media (max-width: 900px) {
      .lista-spesa {
        max-width: 98vw;
        padding-left: 3vw;
        padding-right: 3vw;
      }
    }
    @media (max-width: 600px) {
      .lista-spesa {
        padding: 1em 0.8em;
        border-radius: 7px;
        max-width: 100vw;
      }
    }

    /* Stili per la sezione espandibile verde */
    .lista-spesa .expandable-section {
      border-top: 1px solid #81c784;
      padding-top: 1em;
    }

    .lista-spesa .expand-toggle {
      background: none;
      border: none;
      color: #2e7d32;
      cursor: pointer;
      display: flex;
      align-items: center;
      gap: 0.5em;
      font-size: 0.95em;
      font-weight: 600;
      padding: 0.5em 0;
      transition: color 0.2s;
    }

    .lista-spesa .expand-toggle:hover {
      color: #1b5e20;
    }

    .lista-spesa .details-content h4 {
      margin-top: 1.2em;
      margin-bottom: 0.6em;
      font-size: 1.1em;
      color: #2e7d32;
    }

    .lista-spesa .details-content h4:first-child {
      margin-top: 0;
    }


    /* Stili per i checkbox personalizzati della lista spesa */
    .lista-spesa .checkbox-item {
      display: flex;
      align-items: flex-start;
      gap: 0.8em;
      margin-bottom: 0.6em;
      line-height: 1.4;
    }

    .lista-spesa .custom-checkbox {
      position: relative;
      min-width: 28px;
      width: 28px;
      height: 28px;
      margin-top: 0.1em;
      cursor: pointer;
      border: 2px solid #4caf50;
      border-radius: 6px;
      background: white;
      transition: all 0.2s ease;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .lista-spesa .custom-checkbox:hover {
      background: #f1f8e9;
      transform: scale(1.05);
    }

    .lista-spesa .custom-checkbox.checked {
      background: #4caf50;
      border-color: #4caf50;
    }

    .lista-spesa .custom-checkbox .check-icon {
      opacity: 0;
      transform: scale(0);
      transition: all 0.2s ease;
      color: white;
      width: 18px;
      height: 18px;
    }

    .lista-spesa .custom-checkbox.checked .check-icon {
      opacity: 1;
      transform: scale(1);
    }

    .lista-spesa .checkbox-text {
      flex: 1;
      transition: all 0.3s ease;
      cursor: pointer;
    }

    .lista-spesa .checkbox-text.completed {
      text-decoration: line-through;
      opacity: 0.6;
      color: #666;
    }

    .lista-spesa .checkbox-list {
      list-style: none;
      padding: 0;
      margin: 0.5em 0;
    }

    /* Media query per schermi più piccoli */
    @media (max-width: 600px) {
      .lista-spesa .custom-checkbox {
        min-width: 32px;
        width: 32px;
        height: 32px;
      }
      
      .lista-spesa .checkbox-item {
        gap: 0.6em;
      }
    }


    /* Header della lista della spesa */
    .lista-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      /* width: 100%; */
    }

    /* Aggiusta lo stile del toggle per la nuova struttura */
    .lista-spesa .expand-toggle {
      justify-content: flex-start;
      align-items: center;
      flex: 1;
      text-align: left;
    }

    /* Stili per il pulsante fullscreen */
    .fullscreen-btn {
      background: none;
      border: none;
      color: #2e7d32;
      cursor: pointer;
      padding: 8px;
      transition: color 0.2s;
      display: flex;
      align-items: center;
      flex-shrink: 0;
    }

    .fullscreen-btn:hover {
      color: #1b5e20;
    }

    /* Modalità fullscreen per la lista della spesa */
    .lista-spesa.fullscreen {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      width: 100vw;
      height: 100vh;
      max-width: none;
      margin: 0;
      border-radius: 0;
      border-left: none;
      border-top: 4px solid #4caf50;
      z-index: 10000;
      overflow-y: auto;
      padding: 0;
      box-sizing: border-box;
    }

    .lista-spesa.fullscreen .lista-header {
      position: sticky;
      top: 0;
      background: #e8f5e8;
      z-index: 10001;
      padding: 1em 2em;
      margin: 0;
      border-bottom: none;
    }

    .lista-spesa.fullscreen .expand-toggle .toggle-arrow {
      display: none !important;
    }

    .lista-spesa.fullscreen .details-content {
      display: block !important;
      padding: 0 2em 2em 2em;
    }

    /* Media query per mobile in fullscreen */
    @media (max-width: 600px) {
      .lista-spesa.fullscreen .lista-header {
        padding: 0.8em 1em;
      }
      
      .lista-spesa.fullscreen .details-content {
        padding: 0 1em 2em 1em;
      }
    }


    /* Nascondi il pulsante toggle acqua in modalità viewer */
    body[data-role="viewer"] #waterToggleBtn {
      display: none !important;
    }


    /* Footer */
    .footer {
      text-align: center;
      margin: 3em auto 2em auto;
      font-size: 0.85em;
      color: #888;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 0.3em;
    }
    
    .heart-icon {
      color: #e74c3c;
      font-size: 1.1em;
      animation: heartbeat 1.5s ease-in-out infinite;
    }
    
    @keyframes heartbeat {
      0% { transform: scale(0.8); }
      50% { transform: scale(1.4); }
      100% { transform: scale(0.8); }
    }
    
    @media (max-width: 600px) {
      .footer {
        font-size: 0.8em;
        margin: 2em auto 1.5em auto;
      }
    }


    /* Rimuovi il bordo superiore solo dalla sezione espandibile della sintesi calorica */
    .sintesi-calorica .expandable-section {
      border-top: none;
      padding-top: 1em;
    }

  </style>
</head>
<body>

  <a id="top"></a>

  <!-- Header con logo e titolo -->
  <header class="header">
    <div class="logo">
      <img src="icon-512.png" alt="Food Plan Logo" class="logo-img">
    </div>
    <h1 class="main-title">Food Plan</h1>
  </header>

  <nav class="nav" aria-label="Vai al giorno">
    <a href="#lunedi">Lun</a>
    <a href="#martedi">Mar</a>
    <a href="#mercoledi">Mer</a>
    <a href="#giovedi">Giov</a>
    <a href="#venerdi">Ven</a>
    <a href="#sabato">Sab</a>
    <a href="#domenica">Dom</a>
    <a href="#note">Note</a>
    <a href="#sintesi-calorica">Sintesi calorica</a>
  </nav>

  <div class="lista-spesa" id="lista-spesa">
    <div class="lista-header">
      <button class="expand-toggle" onclick="toggleShoppingList()" aria-expanded="false">
        <svg class="shopping-icon" viewBox="0 0 24 24" width="20" height="20" fill="none" stroke="currentColor" stroke-width="2">
          <circle cx="9" cy="21" r="1"/>
          <circle cx="20" cy="21" r="1"/>
          <path d="m1 1 4 4 4.68 13.39a2 2 0 0 0 1.92 1.61h9.8"/>
          <path d="M6 6h15l-1.68 7.39a2 2 0 0 1-1.92 1.61H6"/>
        </svg>
        <strong class="toggle-text">Lista della spesa</strong>
        <svg class="toggle-arrow" viewBox="0 0 24 24" width="16" height="16" fill="none" stroke="currentColor" stroke-width="2">
          <polyline points="6,9 12,15 18,9"></polyline>
        </svg>
      </button>
      
      <button class="fullscreen-btn" onclick="toggleFullscreen(event)" title="Visualizza a schermo intero" aria-label="Espandi a schermo intero">
        <svg class="fullscreen-icon" viewBox="0 0 24 24" width="18" height="18" fill="none" stroke="currentColor" stroke-width="2">
          <path d="m15 3 6 6m-6-6v6m6-6h-6M9 21l-6-6m6 6v-6m-6 6h6"/>
        </svg>
        <svg class="minimize-icon" viewBox="0 0 24 24" width="18" height="18" fill="none" stroke="currentColor" stroke-width="2" style="display: none;">
          <path d="M8 3v3a2 2 0 0 1-2 2H3m18 0h-3a2 2 0 0 1-2-2V3m0 18v-3a2 2 0 0 0 2-2h3M3 16h3a2 2 0 0 0 2 2v3"/>
        </svg>
      </button>
    </div>
    
    <div class="details-content" id="shoppingListContent" style="display: none;">
      <div style="margin-top: 1em; padding-top: 1em;">
          
          <h4>Ortofrutta</h4>
          <ul class="checkbox-list">
            <li class="checkbox-item">
              <div class="custom-checkbox" onclick="toggleCheckbox(this)">
                <svg class="check-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3" stroke-linecap="round" stroke-linejoin="round">
                  <polyline points="20,6 9,17 4,12"></polyline>
                </svg>
              </div>
              <span class="checkbox-text" onclick="toggleCheckbox(this.previousElementSibling)"><strong>Frutta fresca mista</strong> (banane, pesche, kiwi, albicocche, altra frutta di stagione): 10-12 pezzi (per spuntini colazione)</span>
            </li>
            <li class="checkbox-item">
              <div class="custom-checkbox" onclick="toggleCheckbox(this)">
                <svg class="check-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3" stroke-linecap="round" stroke-linejoin="round">
                  <polyline points="20,6 9,17 4,12"></polyline>
                </svg>
              </div>
              <span class="checkbox-text" onclick="toggleCheckbox(this.previousElementSibling)"><strong>Verdure miste a scelta</strong> (insalata, pomodori, zucchine, carote, spinaci, broccoli, ecc.): quantità abbondante per pranzi e cene</span>
            </li>
            <li class="checkbox-item">
              <div class="custom-checkbox" onclick="toggleCheckbox(this)">
                <svg class="check-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3" stroke-linecap="round" stroke-linejoin="round">
                  <polyline points="20,6 9,17 4,12"></polyline>
                </svg>
              </div>
              <span class="checkbox-text" onclick="toggleCheckbox(this.previousElementSibling)"><strong>Patate medie</strong>: 10-12</span>
            </li>
          </ul>

          <h4>Pane, prodotti da forno e cereali</h4>
          <ul class="checkbox-list">
            <li class="checkbox-item">
              <div class="custom-checkbox" onclick="toggleCheckbox(this)">
                <svg class="check-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3" stroke-linecap="round" stroke-linejoin="round">
                  <polyline points="20,6 9,17 4,12"></polyline>
                </svg>
              </div>
              <span class="checkbox-text" onclick="toggleCheckbox(this.previousElementSibling)"><strong>Pane integrale</strong>: 700 g</span>
            </li>
            <li class="checkbox-item">
              <div class="custom-checkbox" onclick="toggleCheckbox(this)">
                <svg class="check-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3" stroke-linecap="round" stroke-linejoin="round">
                  <polyline points="20,6 9,17 4,12"></polyline>
                </svg>
              </div>
              <span class="checkbox-text" onclick="toggleCheckbox(this.previousElementSibling)"><strong>Pan carré integrale</strong>: 1 confezione</span>
            </li>
            <li class="checkbox-item">
              <div class="custom-checkbox" onclick="toggleCheckbox(this)">
                <svg class="check-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3" stroke-linecap="round" stroke-linejoin="round">
                  <polyline points="20,6 9,17 4,12"></polyline>
                </svg>
              </div>
              <span class="checkbox-text" onclick="toggleCheckbox(this.previousElementSibling)"><strong>Pasta</strong> (integrale o classica): 700 g</span>
            </li>
            <li class="checkbox-item">
              <div class="custom-checkbox" onclick="toggleCheckbox(this)">
                <svg class="check-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3" stroke-linecap="round" stroke-linejoin="round">
                  <polyline points="20,6 9,17 4,12"></polyline>
                </svg>
              </div>
              <span class="checkbox-text" onclick="toggleCheckbox(this.previousElementSibling)"><strong>Riso/orzo/farro/couscous integrali</strong>: 1 confezione mista 500 g</span>
            </li>
            <li class="checkbox-item">
              <div class="custom-checkbox" onclick="toggleCheckbox(this)">
                <svg class="check-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3" stroke-linecap="round" stroke-linejoin="round">
                  <polyline points="20,6 9,17 4,12"></polyline>
                </svg>
              </div>
              <span class="checkbox-text" onclick="toggleCheckbox(this.previousElementSibling)"><strong>Fette biscottate integrali</strong>: 1 confezione</span>
            </li>
            <li class="checkbox-item">
              <div class="custom-checkbox" onclick="toggleCheckbox(this)">
                <svg class="check-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3" stroke-linecap="round" stroke-linejoin="round">
                  <polyline points="20,6 9,17 4,12"></polyline>
                </svg>
              </div>
              <span class="checkbox-text" onclick="toggleCheckbox(this.previousElementSibling)"><strong>Biscotti a scelta</strong>: 1 confezione</span>
            </li>
            <li class="checkbox-item">
              <div class="custom-checkbox" onclick="toggleCheckbox(this)">
                <svg class="check-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3" stroke-linecap="round" stroke-linejoin="round">
                  <polyline points="20,6 9,17 4,12"></polyline>
                </svg>
              </div>
              <span class="checkbox-text" onclick="toggleCheckbox(this.previousElementSibling)"><strong>Cereali per colazione a scelta</strong>: 1 confezione</span>
            </li>
            <li class="checkbox-item">
              <div class="custom-checkbox" onclick="toggleCheckbox(this)">
                <svg class="check-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3" stroke-linecap="round" stroke-linejoin="round">
                  <polyline points="20,6 9,17 4,12"></polyline>
                </svg>
              </div>
              <span class="checkbox-text" onclick="toggleCheckbox(this.previousElementSibling)"><strong>Formelle Weetabix</strong>: 1 confezione</span>
            </li>
            <li class="checkbox-item">
              <div class="custom-checkbox" onclick="toggleCheckbox(this)">
                <svg class="check-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3" stroke-linecap="round" stroke-linejoin="round">
                  <polyline points="20,6 9,17 4,12"></polyline>
                </svg>
              </div>
              <span class="checkbox-text" onclick="toggleCheckbox(this.previousElementSibling)"><strong>Crackers integrali</strong>: 2 confezioni</span>
            </li>
            <li class="checkbox-item">
              <div class="custom-checkbox" onclick="toggleCheckbox(this)">
                <svg class="check-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3" stroke-linecap="round" stroke-linejoin="round">
                  <polyline points="20,6 9,17 4,12"></polyline>
                </svg>
              </div>
              <span class="checkbox-text" onclick="toggleCheckbox(this.previousElementSibling)"><strong>Gallette di riso</strong>: 1 confezione</span>
            </li>
            <li class="checkbox-item">
              <div class="custom-checkbox" onclick="toggleCheckbox(this)">
                <svg class="check-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3" stroke-linecap="round" stroke-linejoin="round">
                  <polyline points="20,6 9,17 4,12"></polyline>
                </svg>
              </div>
              <span class="checkbox-text" onclick="toggleCheckbox(this.previousElementSibling)"><strong>Focaccine</strong> (tipo Esselunga): 1 confezione</span>
            </li>
            <li class="checkbox-item">
              <div class="custom-checkbox" onclick="toggleCheckbox(this)">
                <svg class="check-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3" stroke-linecap="round" stroke-linejoin="round">
                  <polyline points="20,6 9,17 4,12"></polyline>
                </svg>
              </div>
              <span class="checkbox-text" onclick="toggleCheckbox(this.previousElementSibling)"><strong>Barretta Special K</strong>: 2 barrette</span>
            </li>
          </ul>

          <h4>Banco frigo/latticini</h4>
          <ul class="checkbox-list">
            <li class="checkbox-item">
              <div class="custom-checkbox" onclick="toggleCheckbox(this)">
                <svg class="check-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3" stroke-linecap="round" stroke-linejoin="round">
                  <polyline points="20,6 9,17 4,12"></polyline>
                </svg>
              </div>
              <span class="checkbox-text" onclick="toggleCheckbox(this.previousElementSibling)"><strong>Latte parzialmente scremato</strong>: 2 L</span>
            </li>
            <li class="checkbox-item">
              <div class="custom-checkbox" onclick="toggleCheckbox(this)">
                <svg class="check-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3" stroke-linecap="round" stroke-linejoin="round">
                  <polyline points="20,6 9,17 4,12"></polyline>
                </svg>
              </div>
              <span class="checkbox-text" onclick="toggleCheckbox(this.previousElementSibling)"><strong>Yogurt greco 0%</strong>: 2 vasetti</span>
            </li>
            <li class="checkbox-item">
              <div class="custom-checkbox" onclick="toggleCheckbox(this)">
                <svg class="check-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3" stroke-linecap="round" stroke-linejoin="round">
                  <polyline points="20,6 9,17 4,12"></polyline>
                </svg>
              </div>
              <span class="checkbox-text" onclick="toggleCheckbox(this.previousElementSibling)"><strong>Parmigiano grattugiato</strong>: 1 confezione piccola (50 g circa)</span>
            </li>
            <li class="checkbox-item">
              <div class="custom-checkbox" onclick="toggleCheckbox(this)">
                <svg class="check-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3" stroke-linecap="round" stroke-linejoin="round">
                  <polyline points="20,6 9,17 4,12"></polyline>
                </svg>
              </div>
              <span class="checkbox-text" onclick="toggleCheckbox(this.previousElementSibling)"><strong>Pancakes proteici Milkpro</strong>: 1 confezione</span>
            </li>
          </ul>

          <h4>Banco carne, pesce e affettati</h4>
          <ul class="checkbox-list">
            <li class="checkbox-item">
              <div class="custom-checkbox" onclick="toggleCheckbox(this)">
                <svg class="check-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3" stroke-linecap="round" stroke-linejoin="round">
                  <polyline points="20,6 9,17 4,12"></polyline>
                </svg>
              </div>
              <span class="checkbox-text" onclick="toggleCheckbox(this.previousElementSibling)"><strong>Petto di pollo o tacchino</strong>: 300 g</span>
            </li>
            <li class="checkbox-item">
              <div class="custom-checkbox" onclick="toggleCheckbox(this)">
                <svg class="check-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3" stroke-linecap="round" stroke-linejoin="round">
                  <polyline points="20,6 9,17 4,12"></polyline>
                </svg>
              </div>
              <span class="checkbox-text" onclick="toggleCheckbox(this.previousElementSibling)"><strong>Hamburger di manzo o carne rossa magra</strong>: 1 (circa 120 g)</span>
            </li>
            <li class="checkbox-item">
              <div class="custom-checkbox" onclick="toggleCheckbox(this)">
                <svg class="check-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3" stroke-linecap="round" stroke-linejoin="round">
                  <polyline points="20,6 9,17 4,12"></polyline>
                </svg>
              </div>
              <span class="checkbox-text" onclick="toggleCheckbox(this.previousElementSibling)"><strong>Bresaola/tacchino/pollo affettato</strong>: 1 confezione</span>
            </li>
            <li class="checkbox-item">
              <div class="custom-checkbox" onclick="toggleCheckbox(this)">
                <svg class="check-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3" stroke-linecap="round" stroke-linejoin="round">
                  <polyline points="20,6 9,17 4,12"></polyline>
                </svg>
              </div>
              <span class="checkbox-text" onclick="toggleCheckbox(this.previousElementSibling)"><strong>Uova</strong>: 1 confezione da 6</span>
            </li>
            <li class="checkbox-item">
              <div class="custom-checkbox" onclick="toggleCheckbox(this)">
                <svg class="check-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3" stroke-linecap="round" stroke-linejoin="round">
                  <polyline points="20,6 9,17 4,12"></polyline>
                </svg>
              </div>
              <span class="checkbox-text" onclick="toggleCheckbox(this.previousElementSibling)"><strong>Tonno al naturale</strong>: 2 scatolette piccole</span>
            </li>
            <li class="checkbox-item">
              <div class="custom-checkbox" onclick="toggleCheckbox(this)">
                <svg class="check-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3" stroke-linecap="round" stroke-linejoin="round">
                  <polyline points="20,6 9,17 4,12"></polyline>
                </svg>
              </div>
              <span class="checkbox-text" onclick="toggleCheckbox(this.previousElementSibling)"><strong>Salmone affumicato</strong>: 1 busta</span>
            </li>
            <li class="checkbox-item">
              <div class="custom-checkbox" onclick="toggleCheckbox(this)">
                <svg class="check-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3" stroke-linecap="round" stroke-linejoin="round">
                  <polyline points="20,6 9,17 4,12"></polyline>
                </svg>
              </div>
              <span class="checkbox-text" onclick="toggleCheckbox(this.previousElementSibling)"><strong>Filetto/trancio di pesce a scelta</strong>: 1 porzione</span>
            </li>
          </ul>

          <h4>Scaffale (dispensa)</h4>
          <ul class="checkbox-list">
            <li class="checkbox-item">
              <div class="custom-checkbox" onclick="toggleCheckbox(this)">
                <svg class="check-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3" stroke-linecap="round" stroke-linejoin="round">
                  <polyline points="20,6 9,17 4,12"></polyline>
                </svg>
              </div>
              <span class="checkbox-text" onclick="toggleCheckbox(this.previousElementSibling)"><strong>Legumi cotti</strong> (lattina/barattolo): 2-3 barattoli da 400 g</span>
            </li>
            <li class="checkbox-item">
              <div class="custom-checkbox" onclick="toggleCheckbox(this)">
                <svg class="check-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3" stroke-linecap="round" stroke-linejoin="round">
                  <polyline points="20,6 9,17 4,12"></polyline>
                </svg>
              </div>
              <span class="checkbox-text" onclick="toggleCheckbox(this.previousElementSibling)"><strong>Olio extravergine di oliva</strong>: 1 bottiglia piccola</span>
            </li>
            <li class="checkbox-item">
              <div class="custom-checkbox" onclick="toggleCheckbox(this)">
                <svg class="check-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3" stroke-linecap="round" stroke-linejoin="round">
                  <polyline points="20,6 9,17 4,12"></polyline>
                </svg>
              </div>
              <span class="checkbox-text" onclick="toggleCheckbox(this.previousElementSibling)"><strong>Sugo pronto o passata di pomodoro</strong>: 1 bottiglia/barattolo</span>
            </li>
            <li class="checkbox-item">
              <div class="custom-checkbox" onclick="toggleCheckbox(this)">
                <svg class="check-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3" stroke-linecap="round" stroke-linejoin="round">
                  <polyline points="20,6 9,17 4,12"></polyline>
                </svg>
              </div>
              <span class="checkbox-text" onclick="toggleCheckbox(this.previousElementSibling)"><strong>Sale, pepe, spezie varie</strong></span>
            </li>
          </ul>

          <h4>Frutta secca, semi e snack</h4>
          <ul class="checkbox-list">
            <li class="checkbox-item">
              <div class="custom-checkbox" onclick="toggleCheckbox(this)">
                <svg class="check-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3" stroke-linecap="round" stroke-linejoin="round">
                  <polyline points="20,6 9,17 4,12"></polyline>
                </svg>
              </div>
              <span class="checkbox-text" onclick="toggleCheckbox(this.previousElementSibling)"><strong>Frutta secca mista</strong> (mandorle, noci, nocciole): 2 bustine monoporzione da 25 g</span>
            </li>
            <li class="checkbox-item">
              <div class="custom-checkbox" onclick="toggleCheckbox(this)">
                <svg class="check-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3" stroke-linecap="round" stroke-linejoin="round">
                  <polyline points="20,6 9,17 4,12"></polyline>
                </svg>
              </div>
              <span class="checkbox-text" onclick="toggleCheckbox(this.previousElementSibling)"><strong>Semi/granella a scelta</strong>: 1 confezione piccola</span>
            </li>
          </ul>

          <h4>Note</h4>
          <ul>
            <li>Alcuni prodotti (crackers, gallette, pane, affettati, ecc.) sono alternativi tra loro: puoi variare le quantità a seconda delle tue preferenze.</li>
            <li>Per i pasti liberi del weekend, scegli tu cosa acquistare in base ai tuoi gusti.</li>
            <li>Le quantità di frutta e verdura sono abbondanti per garantire varietà e coprire tutti i pasti.</li>
          </ul>
        </div>
      </div>
    </div>
  </div>

  <section id="lunedi">
    <h1>Lunedì</h1>
    <h2 id="lunedi-colazione">Colazione</h2>
    <p id="lunedi-colazione-par">1 tazza di caffelatte con latte parzialmente scremato <strong>+ uno a scelta tra</strong></p>
    <ul class="menu-elenco">
      <li>2 pancakes proteici Milkpro</li>
      <li>3 Formelle Weetabix</li>
      <li>2-3 manciate di cereali a scelta</li>
      <li>5 biscotti a scelta</li>
      <li>5 fette biscottate integrali</li>
    </ul>
    <h2 id="lunedi-spuntinomattina">Spuntino Mattina</h2>
    <p id="lunedi-spuntinomattina-par">1 frutto grande (es. pesca/banana) o 2 piccoli (es. kiwi/albicocche)</p>
    <h2 id="lunedi-pranzo">Pranzo</h2>
    <p id="lunedi-pranzo-par">150g di pasta <strong>oppure</strong></p>
    <ul class="menu-elenco">
      <li>riso/farro/orzo/cous cous (meglio se integrali)</li>
    </ul>
    <p>+ verdure a scelta + massimo 2 cucchiai in totale tra olio, parmigiano e/o sugo</p>
    <h2 id="lunedi-spuntinopomeriggio">Spuntino Pomeriggio</h2>
    <p id="lunedi-spuntinopomeriggio-par">1 toast (2 fette pane in cassetta integrale) con 2-3 fette di affettato magro (tacchino, pollo, bresaola)</p>
    <h2 id="lunedi-cena">Cena</h2>
    <p id="lunedi-cena-par">Carne bianca (petto di pollo/tacchino) circa 2 fettine <strong></strong>+ uno a scelta tra</strong></p>
    <ul class="menu-elenco"></ul>
      <li>100g di pane integrale (circa 2 panini piccoli o 4 fette di pane in cassetta)</li>
      <li>2 pacchetti di crackers</li>
      <li>7 gallette</li>
      <li>90g di focaccia (circa 3 focaccine esselunga)</li>
      <li>3 patate medie</li>
    </ul>
    <p>Aggiungi una porzione di verdure totalmente a scelta sia come varietà sia come quantità</p>
  </section>

  <!-- MARTEDI -->
  <section id="martedi">
    <h1>Martedì</h1>
    <h2 id="martedi-colazione">Colazione</h2>
    <p id="martedi-colazione-par">1 tazza di caffelatte con latte parzialmente scremato <strong>+ uno a scelta tra</strong></p>
    <ul class="menu-elenco">
      <li>2 pancakes proteici Milkpro</li>
      <li>3 Formelle Weetabix</li>
      <li>2-3 manciate di cereali a scelta</li>
      <li>5 biscotti a scelta</li>
      <li>5 fette biscottate integrali</li>
    </ul>
    <h2 id="martedi-spuntinomattina">Spuntino Mattina</h2>
    <p id="martedi-spuntinomattina-par">1 bustina monoporzione da 20-30g frutta secca <strong>oppure</strong></p>
    <ul class="menu-elenco">
      <li>1 yogurt greco 0%</li>
      <li>1 barretta Special K</li>
      <li>1 galletta + semi/granella a scelta</li>
    </ul>
    <h2 id="martedi-pranzo">Pranzo</h2>
    <p id="martedi-pranzo-par">150g di pasta <strong>oppure</strong></p>
    <ul class="menu-elenco">
      <li>riso/farro/orzo/cous cous (meglio se integrali)</li>
    </ul>
    <p>+ verdure a scelta + massimo 2 cucchiai in totale tra olio, parmigiano e/o sugo</p>
    <h2 id="martedi-spuntinopomeriggio">Spuntino Pomeriggio</h2>
    <p id="martedi-spuntinopomeriggio-par">1 toast (2 fette pane in cassetta integrale) con 2-3 fette di affettato magro (tacchino, pollo, bresaola)</p>
    <h2 id="martedi-cena">Cena</h2>
    <p id="martedi-cena-par">3 uova + 100g di pane integrale (circa 2 panini piccoli o 4 fette di pane in cassetta) <strong>oppure</strong></p>
    <ul class="menu-elenco">
      <li>2 pacchetti di crackers</li>
      <li>7 gallette</li>
      <li>90g di focaccia (circa 3 focaccine esselunga)</li>
      <li>3 patate medie</li>
    </ul>
    <p>Aggiungi una porzione di verdure totalmente a scelta sia come varietà sia come quantità</p>
  </section>

  <!-- MERCOLEDI -->
  <section id="mercoledi">
    <h1>Mercoledì</h1>
    <h2 id="mercoledi-colazione">Colazione</h2>
    <p id="mercoledi-colazione-par">1 tazza di caffelatte con latte parzialmente scremato <strong>+ uno a scelta tra</strong></p>
    <ul class="menu-elenco">
      <li>2 pancakes proteici Milkpro</li>
      <li>3 Formelle Weetabix</li>
      <li>2-3 manciate di cereali a scelta</li>
      <li>5 biscotti a scelta</li>
      <li>5 fette biscottate integrali</li>
    </ul>
    <h2 id="mercoledi-spuntinomattina">Spuntino Mattina</h2>
    <p id="mercoledi-spuntinomattina-par">1 frutto grande o 2 piccoli <strong>oppure</strong></p>
    <ul class="menu-elenco">
      <li>1 yogurt greco 0%</li>
      <li>1 barretta Special K</li>
      <li>1 galletta + semi/granella a scelta</li>
    </ul>
    <h2 id="mercoledi-pranzo">Pranzo</h2>
    <p id="mercoledi-pranzo-par">150g di pasta <strong>oppure</strong></p>
    <ul class="menu-elenco">
      <li>riso/farro/orzo/cous cous (meglio se integrali)</li>
    </ul>
    <p>+ verdure a scelta + massimo 2 cucchiai in totale tra olio, parmigiano e/o sugo</p>
    <h2 id="mercoledi-spuntinopomeriggio">Spuntino Pomeriggio</h2>
    <p id="mercoledi-spuntinopomeriggio-par">1 toast (2 fette pane in cassetta integrale) con 2-3 fette di affettato magro (tacchino, pollo, bresaola)</p>
    <h2 id="mercoledi-cena">Cena</h2>
    <p id="mercoledi-cena-par">Legumi a scelta  <strong>+ uno a scelta tra</strong></p>
    <ul class="menu-elenco"></ul>
      <li>+ 100g di pane integrale (circa 2 panini piccoli o 4 fette di pane in cassetta)</li> 
      <li>2 pacchetti di crackers</li>
      <li>7 gallette</li>
      <li>90g di focaccia (circa 3 focaccine esselunga)</li>
      <li>3 patate medie</li>
    </ul>
    <p>Aggiungi una porzione di verdure totalmente a scelta sia come varietà sia come quantità</p>
  </section>

  <!-- GIOVEDI -->
  <section id="giovedi">
    <h1>Giovedì</h1>
    <h2 id="giovedi-colazione">Colazione</h2>
    <p id="giovedi-colazione-par">1 tazza di caffelatte con latte parzialmente scremato <strong>+ uno a scelta tra</strong></p>
    <ul class="menu-elenco">
      <li>2 pancakes proteici Milkpro</li>
      <li>3 Formelle Weetabix</li>
      <li>2-3 manciate di cereali a scelta</li>
      <li>5 biscotti a scelta</li>
      <li>5 fette biscottate integrali</li>
    </ul>
    <h2 id="giovedi-spuntinomattina">Spuntino Mattina</h2>
    <p id="giovedi-spuntinomattina-par">1 frutto grande (es. pesca/banana) o 2 piccoli (es. kiwi/albicocche)</p>
    <h2 id="giovedi-pranzo">Pranzo</h2>
    <p id="giovedi-pranzo-par">150g di pasta <strong>oppure</strong></p>
    <ul class="menu-elenco">
      <li>riso/farro/orzo/cous cous (meglio se integrali)</li>
    </ul>
    <p>+ verdure a scelta + massimo 2 cucchiai in totale tra olio, parmigiano e/o sugo</p>
    <h2 id="giovedi-spuntinopomeriggio">Spuntino Pomeriggio</h2>
    <p id="giovedi-spuntinopomeriggio-par">1 toast (2 fette pane in cassetta integrale) con 2-3 fette di affettato magro (tacchino, pollo, bresaola)</p>
    <h2 id="giovedi-cena">Cena</h2>
    <p id="giovedi-cena-par">1 hamburger di manzo o altra carne rossa magra <strong>+ uno a scelta tra</strong></p>
    <ul class="menu-elenco">
      <li>+ 100g di pane integrale (circa 2 panini piccoli o 4 fette di pane in cassetta) </li>
      <li>2 pacchetti di crackers</li>
      <li>7 gallette</li>
      <li>90g di focaccia (circa 3 focaccine esselunga)</li>
      <li>3 patate medie</li>
    </ul>
    <p>Aggiungi una porzione di verdure totalmente a scelta sia come varietà sia come quantità</p>
  </section>

  <!-- VENERDI -->
  <section id="venerdi">
    <h1>Venerdì</h1>
    <h2 id="venerdi-colazione">Colazione</h2>
    <p id="venerdi-colazione-par">1 tazza di caffelatte con latte parzialmente scremato <strong>+ uno a scelta tra</strong></p>
    <ul class="menu-elenco">
      <li>2 pancakes proteici Milkpro</li>
      <li>3 Formelle Weetabix</li>
      <li>2-3 manciate di cereali a scelta</li>
      <li>5 biscotti a scelta</li>
      <li>5 fette biscottate integrali</li>
    </ul>
    <h2 id="venerdi-spuntinomattina">Spuntino Mattina</h2>
    <p id="venerdi-spuntinomattina-par">1 bustina monoporzione da 20-30g frutta secca <strong>oppure</strong></p>
    <ul class="menu-elenco">
      <li>1 yogurt greco 0%</li>
      <li>1 barretta Special K</li>
      <li>1 galletta + semi/granella a scelta</li>
    </ul>
    <h2 id="venerdi-pranzo">Pranzo</h2>
    <p id="venerdi-pranzo-par">150g di pasta <strong>oppure</strong></p>
    <ul class="menu-elenco">
      <li>riso/farro/orzo/cous cous (meglio se integrali)</li>
    </ul>
    <p>+ verdure a scelta + massimo 2 cucchiai in totale tra olio, parmigiano e/o sugo</p>
    <h2 id="venerdi-spuntinopomeriggio">Spuntino Pomeriggio</h2>
    <p id="venerdi-spuntinopomeriggio-par">1 toast (2 fette pane in cassetta integrale) con 2-3 fette di affettato magro (tacchino, pollo, bresaola)</p>
    <h2 id="venerdi-cena">Cena</h2>
    <p id="venerdi-cena-par">Carne bianca (petto di pollo/tacchino) circa 2 fettine + 100g di pane integrale (circa 2 panini piccoli o 4 fette di pane in cassetta) <strong>oppure</strong></p>
    <ul class="menu-elenco">
      <li>2 pacchetti di crackers</li>
      <li>7 gallette</li>
      <li>90g di focaccia (circa 3 focaccine esselunga)</li>
      <li>3 patate medie</li>
    </ul>
    <p>Aggiungi una porzione di verdure totalmente a scelta sia come varietà sia come quantità</p>
  </section>

  <!-- SABATO -->
  <section id="sabato">
    <h1>Sabato</h1>
    <h2 id="sabato-colazione">Colazione</h2>
    <p id="sabato-colazione-par">1 tazza di caffelatte con latte parzialmente scremato <strong>+ uno a scelta tra</strong></p>
    <ul class="menu-elenco">
      <li>2 pancakes proteici Milkpro</li>
      <li>3 Formelle Weetabix</li>
      <li>2-3 manciate di cereali a scelta</li>
      <li>5 biscotti a scelta</li>
      <li>5 fette biscottate integrali</li>
    </ul>
    <h2 id="sabato-spuntinomattina">Spuntino Mattina</h2>
    <p id="sabato-spuntinomattina-par">NO spuntino</p>
    <h2 id="sabato-pranzo">Pranzo</h2>
    <p id="sabato-pranzo-par">100g di pasta al pomodoro con 1 cucchiaio di olio + verdure a scelta e quantità libera</p>
    <h2 id="sabato-spuntinopomeriggio">Spuntino Pomeriggio</h2>
    <p id="sabato-spuntinopomeriggio-par">NO spuntino</p>
    <h2 id="sabato-cena">Cena</h2>
    <p id="sabato-cena-par">Pasto libero</p>
  </section>

  <!-- DOMENICA -->
  <section id="domenica">
    <h1>Domenica</h1>
    <h2 id="domenica-colazione">Colazione</h2>
    <p id="domenica-colazione-par">1 tazza di caffelatte con latte parzialmente scremato <strong>+ uno a scelta tra</strong></p>
    <ul class="menu-elenco">
      <li>2 pancakes proteici Milkpro</li>
      <li>3 Formelle Weetabix</li>
      <li>2-3 manciate di cereali a scelta</li>
      <li>5 biscotti a scelta</li>
      <li>5 fette biscottate integrali</li>
    </ul>
    <h2 id="domenica-spuntinomattina">Spuntino Mattina</h2>
    <p id="domenica-spuntinomattina-par">NO spuntino</p>
    <h2 id="domenica-pranzo">Pranzo</h2>
    <p id="domenica-pranzo-par">Pasto libero</p>
    <h2 id="domenica-spuntinopomeriggio">Spuntino Pomeriggio</h2>
    <p id="domenica-spuntinopomeriggio-par">NO spuntino</p>
    <h2 id="domenica-cena">Cena</h2>
    <p id="domenica-cena-par">2 scatolette piccole di tonno al naturale <strong>oppure</strong></p>
    <ul class="menu-elenco">
      <li>1 busta di salmone affumicato</li>
      <li>un filetto/trancio di pesce a scelta</li>
    </ul>
    <p>+ 50g di pane integrale (1 panino piccolo o 2 fette di pane in cassetta) <strong>oppure</strong></p>
    <ul class="menu-elenco">
      <li>3,5 gallette</li>
    </ul>
    <p>+ una porzione di verdure totalmente a scelta sia come varietà sia come quantità, condisci con 2 cucchiai di olio</p>
  </section>

  <div class="note" id="note">
    <strong>Note/integrazione</strong>
    <ul>
      <li>Bevi almeno 2,5L di acqua al giorno.</li>
      <li>Sono consentiti 2 pasti liberi a settimana (possono essere spostati nell’arco della settimana) e 1 cono gelato a settimana (oltre ai pasti liberi).</li>
    </ul>
  </div>

  <div class="sintesi-calorica" id="sintesi-calorica">
    <strong>Sintesi calorica</strong>
    <div style="margin-top:0.7em;">
      Il totale settimanale: <strong>10.738 kcal</strong><br>
      Media giornaliera:<strong>~1.534 kcal</strong> <br><br>
      I pasti liberi (sabato cena, domenica pranzo) sono stimati a 800-900 kcal, ma possono variare molto.<br><br>
      Se scegli sempre le opzioni più caloriche (crackers/focaccia/patate vs. pane, biscotti rispetto a pancake, ecc.) il totale può salire di 100-200 kcal/giorno.<br>
      I condimenti, salse, variazioni personali possono cambiare molto l’apporto calorico.
    </div>

    <!-- Sezione espandibile -->
    <div class="expandable-section" style="margin-top: 1.5em;">
      <button class="expand-toggle" onclick="toggleDetails()" aria-expanded="false">
        <span class="toggle-text">Mostra calcoli dettagliati</span>
        <svg class="toggle-arrow" viewBox="0 0 24 24" width="16" height="16" fill="none" stroke="currentColor" stroke-width="2">
          <polyline points="6,9 12,15 18,9"></polyline>
        </svg>
      </button>
      
      <div class="details-content" id="detailsContent" style="display: none;">
        <div style="margin-top: 1em; padding-top: 1em; border-top: 1px solid #ffcc80;">
          
          <h4 style="color: #ff9800; margin-bottom: 0.5em;">Kcal per ogni alimento</h4>
          <div style="font-size: 0.9em; line-height: 1.4; margin-bottom: 1em;">
            Latte parzialmente scremato: 200ml ≈ 90 kcal<br>
            Caffè latte: 200ml latte + caffè (trascurabile)<br>
            Pancake proteico Milkpro: 1 ≈ 80 kcal → 2 ≈ 160 kcal<br>
            Formella Weetabix: 1 ≈ 65 kcal → 3 ≈ 195 kcal<br>
            Cereali: 1 manciata ≈ 20g ≈ 75 kcal → 2.5 manciate ≈ 188 kcal<br>
            Biscotto classico: 1 ≈ 40 kcal → 5 ≈ 200 kcal<br>
            Fette biscottate integrali: 1 ≈ 35 kcal → 5 ≈ 175 kcal<br>
            Frutto grande ≈ 80 kcal / 2 piccoli ≈ 40 kcal ciascuno<br>
            Yogurt greco 0%: ≈ 60 kcal<br>
            Barretta Special K: ≈ 90 kcal<br>
            Bustina frutta secca 25g: ≈ 150 kcal<br>
            Galletta riso: 1 ≈ 35 kcal (7 ≈ 245 kcal, 3.5 ≈ 123 kcal)<br>
            Toast: pane in cassetta integrale 2 fette ≈ 120 kcal + affettato magro ≈ 60 kcal<br>
            Pasta 150g pesata cruda ≈ 530 kcal<br>
            Riso/orzo/farro/couscous integrali 150g ≈ 530 kcal<br>
            Olio/parmigiano/sugo (2 cucchiai): ≈ 80 kcal<br>
            Verdure: trascurabili<br>
            Pane integrale 100g ≈ 230 kcal, 50g ≈ 115 kcal<br>
            Crackers 1 pacchetto ≈ 35g ≈ 150 kcal → 2 ≈ 300 kcal<br>
            Focaccia 90g ≈ 280 kcal<br>
            Patate medie (1 ≈ 150g): 3 ≈ 315 kcal<br>
            Carne bianca 2 fettine ≈ 120g ≈ 130 kcal<br>
            Hamburger manzo ≈ 180 kcal<br>
            Uova 3 ≈ 210 kcal<br>
            Legumi cotti ≈ 200g ≈ 180 kcal<br>
            Tonno naturale 2 scatolette ≈ 160 kcal<br>
            Salmone affumicato 100g ≈ 180 kcal<br>
            Pesce a scelta ≈ 160 kcal
          </div>

          <h4 style="color: #ff9800; margin-bottom: 0.5em;">Calcolo kcal giornaliere</h4>
          <div style="font-size: 0.9em; line-height: 1.4;">
            <strong>Lunedì</strong><br>
            Colazione: caffelatte (90) + biscotti (200) = 290<br>
            Spuntino mattina: frutto grande = 80<br>
            Pranzo: pasta (530) + olio (80) = 610<br>
            Spuntino pomeriggio: toast (180)<br>
            Cena: carne bianca (130) + pane 100g (230) = 360<br>
            <strong>Totale: 1.520 kcal</strong><br><br>

            <strong>Martedì</strong><br>
            Colazione: caffelatte (90) + fette biscottate (175) = 265<br>
            Spuntino mattina: frutta secca (150)<br>
            Pranzo: pasta (530) + olio (80) = 610<br>
            Spuntino pomeriggio: toast (180)<br>
            Cena: 3 uova (210) + pane 100g (230) = 440<br>
            <strong>Totale: 1.645 kcal</strong><br><br>

            <strong>Mercoledì</strong><br>
            Colazione: caffelatte (90) + pancakes (160) = 250<br>
            Spuntino mattina: frutto grande (80)<br>
            Pranzo: pasta (530) + olio (80) = 610<br>
            Spuntino pomeriggio: toast (180)<br>
            Cena: legumi (180) + pane 100g (230) = 410<br>
            <strong>Totale: 1.530 kcal</strong><br><br>

            <strong>Giovedì</strong><br>
            Colazione: caffelatte (90) + cereali (188) = 278<br>
            Spuntino mattina: frutto grande (80)<br>
            Pranzo: pasta (530) + olio (80) = 610<br>
            Spuntino pomeriggio: toast (180)<br>
            Cena: hamburger manzo (180) + pane 100g (230) = 410<br>
            <strong>Totale: 1.558 kcal</strong><br><br>

            <strong>Venerdì</strong><br>
            Colazione: caffelatte (90) + weetabix (195) = 285<br>
            Spuntino mattina: yogurt greco (60)<br>
            Pranzo: pasta (530) + olio (80) = 610<br>
            Spuntino pomeriggio: toast (180)<br>
            Cena: carne bianca (130) + pane 100g (230) = 360<br>
            <strong>Totale: 1.495 kcal</strong><br><br>

            <strong>Sabato</strong><br>
            Colazione: caffelatte (90) + biscotti (200) = 290<br>
            Spuntino mattina: 0<br>
            Pranzo: pasta 100g (355) + olio (40) = 395<br>
            Spuntino pomeriggio: 0<br>
            Cena: pasto libero (~800 kcal stimato)<br>
            <strong>Totale: 1.485 kcal</strong><br><br>

            <strong>Domenica</strong><br>
            Colazione: caffelatte (90) + pancakes (160) = 250<br>
            Spuntino mattina: 0<br>
            Pranzo: pasto libero (~900 kcal stimato)<br>
            Spuntino pomeriggio: 0<br>
            Cena: tonno (160) + pane 50g (115) + olio (80) = 355<br>
            <strong>Totale: 1.505 kcal</strong><br><br>

          </div>
        </div>
      </div>
    </div>
  </div>


  <button id="toTopBtn" title="Torna su" aria-label="Torna all'inizio della pagina">
    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor">
      <path d="M12 19V5" stroke-width="2" stroke-linecap="round"/>
      <path d="M5 12l7-7 7 7" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
    </svg>
  </button>

  <button id="nowBtn" title="Vai al pasto corrente" aria-label="Vai al pasto corrente evidenziato">
    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
      <circle cx="12" cy="12" r="10"/>
      <polyline points="12,6 12,12 16,14"/>
    </svg>
  </button>

  <button id="waterToggleBtn" title="Mostra/nascondi controlli acqua" aria-label="Mostra o nascondi controlli acqua">
    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
      <path d="M12 2.69l5.66 5.66a8 8 0 1 1-11.31 0z" fill="#87ceeb"/>
    </svg>
  </button>

  <script>
   
    // Auto-scroll to today section on page load
    window.addEventListener('DOMContentLoaded', function() {

      // Pulsante scroll to top
      document.getElementById('toTopBtn').onclick = function() {
        window.scrollTo({top: 0, behavior: 'smooth'});
      };

      // Pulsante "now" per andare al pasto corrente
      document.getElementById('nowBtn').onclick = function() {
        evidenziaOrario(); // Richiama la funzione esistente
      };


      // Pulsante "water toggle" per mostrare/nascondere controlli acqua
      document.getElementById('waterToggleBtn').onclick = function() {
        var waterControls = document.getElementById('waterControls');
        var waterToggleBtn = document.getElementById('waterToggleBtn');
        
        if (waterControlsVisible) {
          // Nascondi i controlli acqua
          waterControls.style.display = 'none';
          waterToggleBtn.setAttribute('title', 'Mostra controlli acqua');
          waterToggleBtn.setAttribute('aria-label', 'Mostra controlli acqua');
          console.log('Controlli acqua nascosti');
        } else {
          // Mostra i controlli acqua (ma solo se non siamo in modalità viewer)
          var urlParams = new URLSearchParams(window.location.search);
          var role = urlParams.get('role');
          
          if (role !== 'viewer') {
            waterControls.style.display = 'flex';
            waterToggleBtn.setAttribute('title', 'Nascondi controlli acqua');
            waterToggleBtn.setAttribute('aria-label', 'Nascondi controlli acqua');
            console.log('Controlli acqua mostrati');
          } else {
            console.log('Modalità viewer attiva - controlli acqua rimangono nascosti');
            return; // Non cambiare lo stato se siamo in modalità viewer
          }
        }
        
        // Cambia lo stato
        waterControlsVisible = !waterControlsVisible;
        
        // Salva lo stato nel sessionStorage
        sessionStorage.setItem('waterControlsVisible', waterControlsVisible.toString());
      };

      // AGGIUNGI QUESTA VARIABILE QUI:
      var waterControlsVisible = true; // Default, verrà sovrascritto dal caricamento dello stato

      window.addEventListener('scroll', function() {
        var btnTop = document.getElementById('toTopBtn');
        var btnNow = document.getElementById('nowBtn');
        var btnWaterToggle = document.getElementById('waterToggleBtn');
        
        if (window.scrollY > 300) {
          btnTop.style.display = 'flex';
          btnNow.style.display = 'flex';
          btnWaterToggle.style.display = 'flex';
        } else {
          btnTop.style.display = 'none';
          btnNow.style.display = 'none';
          btnWaterToggle.style.display = 'none';
        }
      });

      // Inizialmente nascosti
      document.getElementById('toTopBtn').style.display = 'none';
      document.getElementById('nowBtn').style.display = 'none';
      document.getElementById('waterToggleBtn').style.display = 'none';


      // Controllo per nascondere waterControls se role=viewer (versione finale corretta)
      function checkViewerRole() {
        var urlParams = new URLSearchParams(window.location.search);
        var role = urlParams.get('role');
        var waterControls = document.getElementById('waterControls');
        var waterToggleBtn = document.getElementById('waterToggleBtn');
        
        // Imposta l'attributo data-role per il CSS
        if (role === 'viewer') {
          document.body.setAttribute('data-role', 'viewer');
        } else {
          document.body.removeAttribute('data-role');
        }
        
        if (role === 'viewer') { 
          // In modalità viewer, nascondi sempre i controlli acqua
          waterControls.style.display = 'none';
          waterControlsVisible = false;
          console.log('Modalità viewer attivata - controlli acqua e pulsante toggle nascosti');
        } else {
          // Se non è viewer, rispetta lo stato salvato o usa il default
          var savedState = sessionStorage.getItem('waterControlsVisible');
          
          if (savedState !== null) {
            // C'è uno stato salvato, usalo
            waterControlsVisible = savedState === 'true';
          } else {
            // Nessuno stato salvato, usa il default (visibile)
            waterControlsVisible = true;
          }
          
          // Applica lo stato
          if (waterControlsVisible) {
            waterControls.style.display = 'flex';
            console.log('Modalità normale - controlli acqua visibili');
          } else {
            waterControls.style.display = 'none';
            console.log('Controlli acqua nascosti (stato salvato)');
          }
          
          // Aggiorna il titolo del pulsante
          if (waterControlsVisible) {
            waterToggleBtn.setAttribute('title', 'Nascondi controlli acqua');
            waterToggleBtn.setAttribute('aria-label', 'Nascondi controlli acqua');
          } else {
            waterToggleBtn.setAttribute('title', 'Mostra controlli acqua');
            waterToggleBtn.setAttribute('aria-label', 'Mostra controlli acqua');
          }
        }
      }


      // Esegui il controllo all'avvio
      checkViewerRole();

      // Giorni per id sezione
      var giorni = [
        "lunedi",
        "martedi",
        "mercoledi",
        "giovedi",
        "venerdi",
        "sabato",
        "domenica"
      ];
      var oggi = (new Date().getDay())-1; // 0: lunedi ... 6: domenica
      // Scroll only if not already anchored (from hash or reload)
      if (!window.location.hash || window.location.hash === "#top" || window.location.hash === "#") {
        var id = giorni[oggi];
        var section = document.getElementById(id);
        if (section) {
          section.scrollIntoView({behavior: "smooth", block: "start"});
        }
      }

      // Toast logic
      function showToast() {
        var toast = document.getElementById('info-toast');
        toast.style.display = 'flex';
      }
      function hideToast() {
        var toast = document.getElementById('info-toast');
        toast.style.display = 'none';
      }
      document.querySelector('#info-toast .toast-close').onclick = hideToast;

      // Evidenziazione e toast
      function evidenziaOrario() {
        // Rimuovi highlight ovunque prima
        document.querySelectorAll('.highlight').forEach(function(el) {
          el.classList.remove('highlight');
        });
        // Nascondi toast
        hideToast();
        var giorni = [
          "lunedi",
          "martedi",
          "mercoledi",
          "giovedi",
          "venerdi",
          "sabato",
          "domenica"
        ];
        var now = new Date();
        var oggi = (now.getDay())-1;  // 0: lunedi ... 6: domenica
        var ore = now.getHours();
        var minuti = now.getMinutes();
        var idGiorno = giorni[oggi];
        var fascia = null;
        var timeMin = ore * 60 + minuti;
        /*
          - 5:30 - 10:00 => colazione
          - 10:01 - 12:00 => spuntino mattina
          - 12:01 - 14:30 => pranzo
          - 14:31 - 17:30 => spuntino pomeriggio
          - 17:31 - 22:30 => cena
          - 22:31 - 5:29 => nessuna fascia, mostra toast
        */
        if (timeMin >= 330 && timeMin <= 600) { // 5:30 - 10:00
          fascia = 'colazione';
        } else if (timeMin >= 601 && timeMin <= 720) { // 10:01 - 12:00
          fascia = 'spuntinomattina';
        } else if (timeMin >= 721 && timeMin <= 870) { // 12:01 - 14:30
          fascia = 'pranzo';
        } else if (timeMin >= 871 && timeMin <= 1050) { // 14:31 - 17:30
          fascia = 'spuntinopomeriggio';
        } else if (timeMin >= 1051 && timeMin <= 1350) { // 17:31 - 22:30
          fascia = 'cena';
        }
        if (fascia) {
          // Evidenzia h2 e relativo paragrafo
          var h2 = document.getElementById(idGiorno + '-' + fascia);
          h2.classList.add("highlight");

          // Trova tutti gli elementi successivi fino al prossimo h2 o h1
          var currentElement = h2.nextElementSibling;
          while (currentElement && currentElement.tagName !== 'H2' && currentElement.tagName !== 'H1') {
            currentElement.classList.add("highlight");
            currentElement = currentElement.nextElementSibling;
          }

          // Scrolla il primo elemento evidenziato al centro dello schermo
          setTimeout(function() {
            var evidenziato = document.querySelector('.highlight');
            if (evidenziato) {
              evidenziato.scrollIntoView({behavior: "smooth", block: "center"});

              var elementTop = evidenziato.getBoundingClientRect().top + window.pageYOffset;
              var offsetTop = elementTop - 177; // 177px dall'alto
              window.scrollTo({
                top: offsetTop,
                behavior: "smooth"
              });
            }
          }, 120); // Timeout breve per assicurare che l'highlight sia applicato
        } else {
          // Mostra toast solo se NON in fascia oraria
          showToast();
        }
      }

      evidenziaOrario();
      setInterval(evidenziaOrario, 60000);


      // Variabile globale per tracciare la sezione visibile corrente
      var visibleSection = -1; // -1 indica nessuna sezione visibile

      // AGGIUNGI QUI l'Intersection Observer per il rilevamento delle sezioni visibili
      // Crea l'observer per rilevare quando le sezioni sono visibili al 60%
      var sectionObserver = new IntersectionObserver(function(entries) {
        entries.forEach(function(entry) {
          if (entry.isIntersecting) {
            var dayIds = ['lunedi', 'martedi', 'mercoledi', 'giovedi', 'venerdi', 'sabato', 'domenica'];
            var newIndex = dayIds.indexOf(entry.target.id);
            
            if (newIndex !== -1 && newIndex !== visibleSection) {
              visibleSection = newIndex;
              console.log('Sezione visibile al 52%: ' + entry.target.id + ' (indice: ' + visibleSection + ')');
            }
          }
        });
      }, {
        threshold: 0.52, // 52% di visibilità per considerare la sezione come visibile
        rootMargin: '0px'
      });

      // Osserva tutte le sezioni dei giorni
      var sectionsToObserve = document.querySelectorAll('section[id]');
      sectionsToObserve.forEach(function(section) {
        // Osserva solo le sezioni dei giorni (esclude eventuali altre sezioni)
        var dayIds = ['lunedi', 'martedi', 'mercoledi', 'giovedi', 'venerdi', 'sabato', 'domenica'];
        if (dayIds.includes(section.id)) {
          sectionObserver.observe(section);
        }
      });



      // AGGIUNGI QUI la gestione degli swipe
      var touchStartX = 0;
      var touchEndX = 0;
      var minSwipeDistance = 80;
      
      // Array dei giorni della settimana
      var giorniArray = [
        "lunedi", "martedi", "mercoledi", "giovedi", 
        "venerdi", "sabato", "domenica"
      ];
      
      // Funzione per ottenere la fascia oraria corrente
      function getCurrentFascia() {
        var now = new Date();
        var ore = now.getHours();
        var minuti = now.getMinutes();
        var timeMin = ore * 60 + minuti;
        
        if (timeMin >= 330 && timeMin <= 600) { // 5:30 - 10:00
          return 'colazione';
        } else if (timeMin >= 601 && timeMin <= 720) { // 10:01 - 12:00
          return 'spuntinomattina';
        } else if (timeMin >= 721 && timeMin <= 870) { // 12:01 - 14:30
          return 'pranzo';
        } else if (timeMin >= 871 && timeMin <= 1050) { // 14:31 - 17:30
          return 'spuntinopomeriggio';
        } else if (timeMin >= 1051 && timeMin <= 1350) { // 17:31 - 22:30
          return 'cena';
        }
        return null;
      }

      // Funzione per mostrare il toast di swipe con il nome del giorno
      function showSwipeToast(dayName) {
        var toast = document.getElementById('swipe-toast');
        
        // Mappa dei nomi dei giorni in italiano
        var dayNames = {
          'lunedi': 'Lunedì',
          'martedi': 'Martedì', 
          'mercoledi': 'Mercoledì',
          'giovedi': 'Giovedì',
          'venerdi': 'Venerdì',
          'sabato': 'Sabato',
          'domenica': 'Domenica'
        };
        
        var displayName = dayNames[dayName] || dayName;
        toast.textContent = displayName;
        toast.classList.add('show');
        
        setTimeout(function() {
          toast.classList.remove('show');
        }, 2000);
      }
      
      // Funzione per navigare a un giorno specifico
      function navigateToDay(targetDay) {
        var targetSection = document.getElementById(targetDay);
        if (!targetSection) return;
        
        // Ottieni la fascia oraria corrente
        var currentFascia = getCurrentFascia();
        
        if (currentFascia) {
          // Se c'è una fascia oraria, scrolla a quella specifica del nuovo giorno
          var targetElement = document.getElementById(targetDay + '-' + currentFascia);
          if (targetElement) {
            targetElement.scrollIntoView({behavior: "smooth", block: "center"});
          } else {
            // Se non esiste quella fascia per quel giorno, scrolla all'inizio della sezione
            targetSection.scrollIntoView({behavior: "smooth", block: "start"});
          }
        } else {
          // Se non c'è fascia oraria, scrolla all'inizio della sezione
          targetSection.scrollIntoView({behavior: "smooth", block: "start"});
        }

        // Mostra il toast con il nome del giorno
        showSwipeToast(targetDay);
      }
      
      // Event listeners per il touch
      var isSwipeOnSection = false;
      
      document.addEventListener('touchstart', function(e) {
        // Controlla se il touch è su una sezione di giorno
        var target = e.target.closest('section[id]');
        if (target && giorniArray.includes(target.id)) {
          isSwipeOnSection = true;
          touchStartX = e.changedTouches[0].screenX;
        } else {
          isSwipeOnSection = false;
        }
      });
      
      document.addEventListener('touchend', function(e) {
        if (isSwipeOnSection) {
          touchEndX = e.changedTouches[0].screenX;
          handleSwipe();
        }
        isSwipeOnSection = false;
      });
      
      function handleSwipe() {
        // Controlla se la visibleSection è valida
        if (visibleSection === -1) return;
        
        var swipeDistance = touchEndX - touchStartX;
        
        // Swipe da sinistra a destra (vai al giorno successivo)
        if (swipeDistance > minSwipeDistance) {
          var nextIndex;
          if (visibleSection === 6) { // Se siamo a domenica (indice 6)
            nextIndex = 0; // Vai al lunedì (indice 0)
          } else {
            nextIndex = visibleSection + 1;
          }
          var nextDay = giorniArray[nextIndex];
          navigateToDay(nextDay);
        }
        // Swipe da destra a sinistra (vai al giorno precedente)
        else if (swipeDistance < -minSwipeDistance) {
          var prevIndex;
          if (visibleSection === 0) { // Se siamo a lunedì (indice 0)
            prevIndex = 6; // Vai alla domenica (indice 6)
          } else {
            prevIndex = visibleSection - 1;
          }
          var prevDay = giorniArray[prevIndex];
          navigateToDay(prevDay);
        }
      }







      // Variabile globale per il livello dell'acqua (0-100)
      var waterLevel = 0;
      var waterIncrement = 100/13; // ~7.69 per ogni click

      // Funzione per ottenere la data corrente in formato YYYY-MM-DD
      function getCurrentDate() {
        var today = new Date();
        var year = today.getFullYear();
        var month = String(today.getMonth() + 1).padStart(2, '0');
        var day = String(today.getDate()).padStart(2, '0');
        return year + '-' + month + '-' + day;
      }

      // Carica il livello dell'acqua dal sessionStorage
      function loadWaterLevel() {
        var savedLevel = sessionStorage.getItem('waterLevel');
        var savedDate = sessionStorage.getItem('waterDate');
        var currentDate = getCurrentDate();
        
        // Se non c'è una data salvata o la data è cambiata, resetta tutto
        if (!savedDate || savedDate !== currentDate) {
          waterLevel = 0;
          sessionStorage.setItem('waterDate', currentDate);
          sessionStorage.setItem('waterLevel', '0');
          console.log('Nuovo giorno rilevato (' + currentDate + '), waterLevel resettato a 0');
        } else if (savedLevel !== null) {
          // Stesso giorno, carica il livello salvato
          waterLevel = parseFloat(savedLevel);
          // Assicurati che sia nel range valido
          waterLevel = Math.max(0, Math.min(100, waterLevel));
          console.log('Livello acqua caricato per oggi (' + currentDate + '):', waterLevel.toFixed(2) + '%');
        }
      }

      // Salva il livello dell'acqua nel sessionStorage
      function saveWaterLevel() {
        var currentDate = getCurrentDate();
        sessionStorage.setItem('waterLevel', waterLevel.toString());
        sessionStorage.setItem('waterDate', currentDate);
      }

      // Funzione per aggiornare l'SVG del bicchiere
      function updateWaterGlass(level) {
        var svg = document.querySelector('#waterGlass svg');
        var waterPath = svg.querySelector('.water-fill');
        var waterReflection = svg.querySelector('.water-reflection');
        var emptyBackground = svg.querySelector('.empty-background');
        
        // Rimuovi elementi acqua ed sfondo esistenti
        if (waterPath) waterPath.remove();
        if (waterReflection) waterReflection.remove();
        if (emptyBackground) emptyBackground.remove();
        
        // Crea sempre lo sfondo grigio per la parte vuota del bicchiere
        var emptyBgElement = document.createElementNS('http://www.w3.org/2000/svg', 'path');
        emptyBgElement.setAttribute('class', 'empty-background');
        emptyBgElement.setAttribute('d', 'M19.2 24 L100.8 24 L96 156 L24 156 Z');
        emptyBgElement.setAttribute('fill', '#f5f5f5');
        emptyBgElement.setAttribute('opacity', '0.8');
        
        // Inserisci lo sfondo per primo (dietro tutto)
        var firstChild = svg.firstChild;
        svg.insertBefore(emptyBgElement, firstChild);
        
        if (level > 0) {
          // Calcola la posizione Y dell'acqua basata sulla percentuale
          // Bicchiere va da y=24 (top) a y=156 (bottom), altezza totale = 132
          var waterHeight = (level / 100) * 132;
          var waterTop = 156 - waterHeight;
          
          // Calcola la larghezza in base alla forma trapezoidale del bicchiere
          var topWidth = 81.6; // Larghezza in alto (100.8 - 19.2)
          var bottomWidth = 72; // Larghezza in basso (96 - 24)
          var currentTopWidth = topWidth - (topWidth - bottomWidth) * (waterTop - 24) / 132;
          
          var leftTop = 60 - currentTopWidth / 2;
          var rightTop = 60 + currentTopWidth / 2;
          var leftBottom = 60 - bottomWidth / 2;
          var rightBottom = 60 + bottomWidth / 2;
          
          // Crea il path dell'acqua
          var waterPathElement = document.createElementNS('http://www.w3.org/2000/svg', 'path');
          waterPathElement.setAttribute('class', 'water-fill');
          waterPathElement.setAttribute('d', 'M' + leftTop + ' ' + waterTop + ' L' + rightTop + ' ' + waterTop + ' L' + rightBottom + ' 156 L' + leftBottom + ' 156 Z');
          waterPathElement.setAttribute('fill', '#87ceeb');
          waterPathElement.setAttribute('opacity', '0.9');
          
          // Crea il riflesso
          /*
          var reflectionElement = document.createElementNS('http://www.w3.org/2000/svg', 'ellipse');
          reflectionElement.setAttribute('class', 'water-reflection');
          reflectionElement.setAttribute('cx', '48');
          reflectionElement.setAttribute('cy', waterTop + waterHeight * 0.3);
          reflectionElement.setAttribute('rx', '19.2');
          reflectionElement.setAttribute('ry', Math.max(3, waterHeight * 0.08));
          reflectionElement.setAttribute('fill', '#b8e0f5');
          reflectionElement.setAttribute('opacity', '0.7');
          */
          
          // Inserisci gli elementi nell'SVG (dopo lo sfondo ma prima del contorno)
          var contour = svg.querySelector('path[stroke="#4a90e2"]');
          svg.insertBefore(waterPathElement, contour);
          //svg.insertBefore(reflectionElement, contour);
        }
      }

      // Funzione per aggiornare la percentuale e i litri mostrati
      function updateWaterPercentage(level) {
        var percentageElement = document.getElementById('waterPercentage');
        var litersElement = document.getElementById('waterLiters');
        var liters = (level / 100) * 2.5; // 2.5L è il 100%
        
        percentageElement.childNodes[0].textContent = Math.round(level) + '%';
        litersElement.textContent = liters.toFixed(1) + 'L';
      }

      // Gestori eventi per i pulsanti
      document.getElementById('waterPlus').addEventListener('click', function() {
        if (waterLevel < 100) {
          var prevLevel = waterLevel;
          waterLevel = Math.min(100, waterLevel + waterIncrement);
          console.log('Pulsante +: livello prima del click:', prevLevel.toFixed(2), '→ livello dopo:', waterLevel.toFixed(2));
          updateWaterGlass(waterLevel);
          updateWaterPercentage(waterLevel);
          saveWaterLevel(); // Salva nel sessionStorage con la data

          // Celebra se ha raggiunto il 100%
          if (waterLevel >= 100 && prevLevel < 100) {
            setTimeout(celebrate, 300); // Piccolo ritardo per far vedere l'aggiornamento
          }
        }
      });

      document.getElementById('waterMinus').addEventListener('click', function() {
        if (waterLevel > 0) {
          var prevLevel = waterLevel;
          waterLevel = Math.max(0, waterLevel - waterIncrement);
          console.log('Pulsante -: livello prima del click:', prevLevel.toFixed(2), '→ livello dopo:', waterLevel.toFixed(2));
          updateWaterGlass(waterLevel);
          updateWaterPercentage(waterLevel);
          saveWaterLevel(); // Salva nel sessionStorage con la data
        }
      });

      // Carica il livello salvato e inizializza il bicchiere al caricamento della pagina
      loadWaterLevel();
      updateWaterGlass(waterLevel);
      updateWaterPercentage(waterLevel);

      // Carica stati checkbox e fullscreen
      loadCheckboxStates();
      loadFullscreenState();

      // Auto-scroll to today section on page load - MODIFICATO
      var savedFullscreen = sessionStorage.getItem('shoppingListFullscreen');
      var savedExpanded = sessionStorage.getItem('shoppingListExpanded');
      
      // Solo se NON siamo in fullscreen E la lista NON è aperta, naviga al giorno corrente
      if (savedFullscreen !== 'true' && savedExpanded !== 'true') {
        var giorni = [
          "lunedi",
          "martedi", 
          "mercoledi",
          "giovedi",
          "venerdi",
          "sabato",
          "domenica"
        ];
        var oggi = (new Date().getDay())-1; // 0: lunedi ... 6: domenica
        
        // Scroll only if not already anchored (from hash or reload)
        if (!window.location.hash || window.location.hash === "#top" || window.location.hash === "#") {
          var id = giorni[oggi];
          var section = document.getElementById(id);
          if (section) {
            section.scrollIntoView({behavior: "smooth", block: "start"});
            
            // Evidenzia la fascia oraria dopo lo scroll
            setTimeout(function() {
              evidenziaOrario();
            }, 800);
          }
        }
      }
      // Se la lista è aperta ma non in fullscreen, lo scroll alla lista 
      // viene già gestito da loadFullscreenState()

       // Funzione per creare i coriandoli
      function createConfetti() {
        var container = document.getElementById('confettiContainer');
        container.innerHTML = ''; // Pulisce eventuali coriandoli precedenti
        container.style.display = 'block';
        
        // Crea 150 coriandoli
        for (var i = 0; i < 150; i++) {
          var confetti = document.createElement('div');
          confetti.className = 'confetti';
          
          // Forme casuali
          var shapes = ['', 'confetti-square', 'confetti-triangle'];
          var randomShape = shapes[Math.floor(Math.random() * shapes.length)];
          if (randomShape) confetti.classList.add(randomShape);
          
          // Posizione casuale orizzontale
          confetti.style.left = Math.random() * 100 + '%';
          
          // Ritardo casuale
          confetti.style.animationDelay = '-' + (Math.random() * 3) + 's';
          
          // Durata leggermente variabile
          confetti.style.animationDuration = (6 + Math.random() * 2) + 's';
          
          container.appendChild(confetti);
        }
        
        // Rimuovi i coriandoli dopo 7 secondi
        setTimeout(function() {
          container.style.display = 'none';
        }, 18000);
      }
      
      // Funzione per riprodurre l'audio di vittoria
      function playVictorySound() {
        var audio = document.getElementById('victorySound');
        if (audio) {
          audio.currentTime = 0; // Riavvolgi all'inizio
          audio.play().catch(function(error) {
            console.log('Impossibile riprodurre l\'audio:', error);
          });
        }
      }

      // Funzioni per il toast di successo
      function showSuccessToast() {
        var toast = document.getElementById('success-toast');
        toast.style.display = 'flex';
        
      }
      
      function hideSuccessToast() {
        var toast = document.getElementById('success-toast');
        toast.style.display = 'none';
      }
      document.querySelector('#success-toast .toast-close').onclick = hideSuccessToast;
      
      // Funzione per celebrare il raggiungimento del 100%
      function celebrate() {
        createConfetti();
        playVictorySound();
        showSuccessToast(); // Mostra il toast verde
        console.log('🎉 Congratulazioni! Hai raggiunto il 100% dell\'obiettivo giornaliero di acqua!');
      }



      
    }); // fine DOMContentLoaded


    // Ricarica la pagina ogni volta che torna in foreground (AGGIORNATO)
    document.addEventListener('visibilitychange', function() {
      if (document.visibilityState === 'visible') {
        // Controlla se siamo in modalità fullscreen della lista spesa
        var savedFullscreen = sessionStorage.getItem('shoppingListFullscreen');
        var savedExpanded = sessionStorage.getItem('shoppingListExpanded');
        
        if (savedFullscreen !== 'true') {
          // Non siamo in fullscreen della lista spesa
          
          if (savedExpanded === 'true') {
            // Lista della spesa è aperta in pagina normale → scrolla all'inizio della lista
            console.log('Lista della spesa aperta - scroll all\'inizio della lista');
            setTimeout(function() {
              var listBox = document.getElementById('lista-spesa');
              if (listBox) {
                listBox.scrollIntoView({ behavior: 'smooth', block: 'start' });
              }
            }, 100);
            
          } else {
            // Lista della spesa è chiusa → ricarica normalmente (andrà al giorno corrente)
            console.log('Lista della spesa chiusa - ricaricamento normale');
            window.location.reload();
          }
          
        } else {
          // Siamo in fullscreen, non ricaricare ma logga l'evento
          console.log('Pagina tornata in foreground ma lista spesa in fullscreen - ricaricamento saltato');
        }
      }
    });

    // Funzione per mostrare/nascondere i dettagli calorici
      function toggleDetails() {
        var content = document.getElementById('detailsContent');
        var button = document.querySelector('.expand-toggle');
        var text = button.querySelector('.toggle-text');
        var isExpanded = button.getAttribute('aria-expanded') === 'true';
        
        if (isExpanded) {
          content.style.display = 'none';
          button.setAttribute('aria-expanded', 'false');
          text.textContent = 'Mostra calcoli dettagliati';
        } else {
          content.style.display = 'block';
          button.setAttribute('aria-expanded', 'true');
          text.textContent = 'Nascondi calcoli dettagliati';
        }
      }

      // Funzione per mostrare/nascondere la lista della spesa (aggiornata)
      function toggleShoppingList() {
        // Se siamo in fullscreen, non permettere la chiusura tramite il toggle principale
        if (isFullscreen) {
          return;
        }
        
        var content = document.getElementById('shoppingListContent');
        var button = document.querySelector('.lista-spesa .expand-toggle');
        var text = button.querySelector('.toggle-text');
        var isExpanded = button.getAttribute('aria-expanded') === 'true';
        
        if (isExpanded) {
          content.style.display = 'none';
          button.setAttribute('aria-expanded', 'false');
          text.textContent = 'Lista della spesa';
        } else {
          content.style.display = 'block';
          button.setAttribute('aria-expanded', 'true');
          text.textContent = 'Lista della spesa';
        }
      }


      // Funzione per gestire il toggle dei checkbox nella lista spesa (aggiornata)
      function toggleCheckbox(checkboxElement) {
        var textElement = checkboxElement.nextElementSibling;
        var isChecked = checkboxElement.classList.contains('checked');
        
        if (isChecked) {
          // Deseleziona
          checkboxElement.classList.remove('checked');
          textElement.classList.remove('completed');
        } else {
          // Seleziona
          checkboxElement.classList.add('checked');
          textElement.classList.add('completed');
        }
        
        // Salva lo stato dei checkbox
        saveCheckboxStates();
      }

      // Funzione per salvare lo stato dei checkbox nel sessionStorage
      function saveCheckboxStates() {
        var checkboxes = document.querySelectorAll('.lista-spesa .custom-checkbox');
        var states = [];
        
        checkboxes.forEach(function(checkbox, index) {
          states[index] = checkbox.classList.contains('checked');
        });
        
        sessionStorage.setItem('shoppingListCheckboxes', JSON.stringify(states));
        console.log('Stati checkbox salvati:', states);
      }

      // Funzione per caricare lo stato dei checkbox dal sessionStorage
      function loadCheckboxStates() {
        var savedStates = sessionStorage.getItem('shoppingListCheckboxes');
        
        if (savedStates) {
          try {
            var states = JSON.parse(savedStates);
            var checkboxes = document.querySelectorAll('.lista-spesa .custom-checkbox');
            
            checkboxes.forEach(function(checkbox, index) {
              if (states[index] === true) {
                var textElement = checkbox.nextElementSibling;
                checkbox.classList.add('checked');
                textElement.classList.add('completed');
              }
            });
            
            console.log('Stati checkbox caricati:', states);
          } catch (error) {
            console.log('Errore nel caricamento degli stati checkbox:', error);
          }
        }
      }


      // Funzione per salvare lo stato fullscreen
      function saveFullscreenState() {
        sessionStorage.setItem('shoppingListFullscreen', isFullscreen.toString());
        if (isFullscreen) {
          sessionStorage.setItem('shoppingListExpanded', 'true');
        }
        console.log('Stato fullscreen salvato:', isFullscreen);
      }

      // Funzione per caricare lo stato fullscreen
      function loadFullscreenState() {
        var savedFullscreen = sessionStorage.getItem('shoppingListFullscreen');
        var savedExpanded = sessionStorage.getItem('shoppingListExpanded');
        
        if (savedFullscreen === 'true') {
          // Ripristina modalità fullscreen
          var listBox = document.getElementById('lista-spesa');
          var body = document.body;
          var fullscreenIcon = document.querySelector('.fullscreen-icon');
          var minimizeIcon = document.querySelector('.minimize-icon');
          var fullscreenBtn = document.querySelector('.fullscreen-btn');
          var content = document.getElementById('shoppingListContent');
          var button = document.querySelector('.lista-spesa .expand-toggle');
          
          // Attiva fullscreen
          listBox.classList.add('fullscreen');
          body.classList.add('fullscreen-active');
          
          // Forza l'apertura della lista
          content.style.display = 'block';
          button.setAttribute('aria-expanded', 'true');
          
          // Cambia icone
          fullscreenIcon.style.display = 'none';
          minimizeIcon.style.display = 'block';
          fullscreenBtn.setAttribute('title', 'Esci dalla modalità schermo intero');
          fullscreenBtn.setAttribute('aria-label', 'Esci dalla modalità schermo intero');
          
          isFullscreen = true;
          console.log('Modalità fullscreen ripristinata');
          
        } else if (savedExpanded === 'true') {
          // Se non era in fullscreen ma era espansa, ripristina solo l'espansione
          var content = document.getElementById('shoppingListContent');
          var button = document.querySelector('.lista-spesa .expand-toggle');
          content.style.display = 'block';
          button.setAttribute('aria-expanded', 'true');
          console.log('Lista della spesa ripristinata come espansa');

          console.log('Lista della spesa aperta - scroll all\'inizio della lista');
          setTimeout(function() {
            var listBox = document.getElementById('lista-spesa');
            if (listBox) {
              listBox.scrollIntoView({ behavior: 'smooth', block: 'start' });
            }
          }, 100);
        }
      }

      // Variabile per tracciare lo stato fullscreen
      var isFullscreen = false;

      // Funzione per gestire il toggle fullscreen (aggiornata)
      function toggleFullscreen(event) {
        event.stopPropagation(); // Previene l'attivazione del toggle della lista
        
        var listBox = document.getElementById('lista-spesa');
        var body = document.body;
        var fullscreenIcon = document.querySelector('.fullscreen-icon');
        var minimizeIcon = document.querySelector('.minimize-icon');
        var fullscreenBtn = document.querySelector('.fullscreen-btn');
        
        if (!isFullscreen) {
          // Entra in modalità fullscreen
          listBox.classList.add('fullscreen');
          body.classList.add('fullscreen-active');
          
          // Forza l'apertura della lista se chiusa
          var content = document.getElementById('shoppingListContent');
          var button = document.querySelector('.lista-spesa .expand-toggle');
          content.style.display = 'block';
          button.setAttribute('aria-expanded', 'true');
          
          // Cambia icona
          fullscreenIcon.style.display = 'none';
          minimizeIcon.style.display = 'block';
          fullscreenBtn.setAttribute('title', 'Esci dalla modalità schermo intero');
          fullscreenBtn.setAttribute('aria-label', 'Esci dalla modalità schermo intero');
          
          // Scrolla in cima alla lista
          listBox.scrollTop = 0;
          
          isFullscreen = true;
          saveFullscreenState(); // Salva lo stato
          console.log('Lista della spesa: modalità fullscreen attivata');
          
        } else {
          // Esce dalla modalità fullscreen
          listBox.classList.remove('fullscreen');
          body.classList.remove('fullscreen-active');
          
          // Cambia icona
          fullscreenIcon.style.display = 'block';
          minimizeIcon.style.display = 'none';
          fullscreenBtn.setAttribute('title', 'Visualizza a schermo intero');
          fullscreenBtn.setAttribute('aria-label', 'Espandi a schermo intero');
          
          isFullscreen = false;
          saveFullscreenState(); // Salva lo stato
          console.log('Lista della spesa: modalità fullscreen disattivata');
          
          // Scrolla alla lista nella pagina normale
          //setTimeout(function() {
          //  listBox.scrollIntoView({ behavior: 'smooth', block: 'start' });
          //}, 100);
        }
      }

      // Funzione per mostrare/nascondere la lista della spesa (aggiornata)
      function toggleShoppingList() {
        // Se siamo in fullscreen, non permettere la chiusura tramite il toggle principale
        if (isFullscreen) {
          return;
        }
        
        var content = document.getElementById('shoppingListContent');
        var button = document.querySelector('.lista-spesa .expand-toggle');
        var text = button.querySelector('.toggle-text');
        var isExpanded = button.getAttribute('aria-expanded') === 'true';
        
        if (isExpanded) {
          content.style.display = 'none';
          button.setAttribute('aria-expanded', 'false');
          text.textContent = 'Lista della spesa';
          sessionStorage.removeItem('shoppingListExpanded');
        } else {
          content.style.display = 'block';
          button.setAttribute('aria-expanded', 'true');
          text.textContent = 'Lista della spesa';
          sessionStorage.setItem('shoppingListExpanded', 'true');
        }
      }

      // Esci dal fullscreen con il tasto ESC
      document.addEventListener('keydown', function(event) {
        if (event.key === 'Escape' && isFullscreen) {
          toggleFullscreen(event);
        }
      });


    
  </script>

  <!-- Toast message -->
  <div id="info-toast" role="alert" aria-live="polite" style="display:none;">
    <span class="toast-icon" aria-hidden="true">
      <img src="lamp.png" alt="Attenzione" class="toast-icon">
    </span>
    <span class="toast-msg">
      <b>Hai fame?</b> Ti ricordo che in questa fascia oraria non è previsto nessun alimento: pensa al vero motivo per cui hai fame. Al massimo, ti consiglio di bere dell'acqua.
    </span>
    <button class="toast-close" title="Chiudi" aria-label="Chiudi">&times;</button>
  </div>



  <!-- Controlli bicchiere d'acqua -->
  <div id="waterControls">
    
    <!-- Bicchiere d'acqua -->
    <div id="waterGlass" title="Ricordati di bere acqua!">
      <!-- Percentuale dentro al bicchiere -->
      <div class="water-percentage" id="waterPercentage">0%
        <div class="water-liters" id="waterLiters">0.0L</div>
      </div>
      
      <svg viewBox="0 0 120 168" xmlns="http://www.w3.org/2000/svg">
        <!-- Contorno del bicchiere -->
        <path d="M19.2 24 L100.8 24 L96 156 L24 156 Z" fill="none" stroke="#4a90e2" stroke-width="2.4" opacity="0.8"/>
 
        <!-- Bordo superiore del bicchiere - riempito di azzurro chiaro -->
        <ellipse cx="60" cy="24" rx="40.8" ry="4.8" fill="#e6f3ff" stroke="#4a90e2" stroke-width="2.4" opacity="0.8"/>
      </svg>
    </div>
    
    <!-- Pulsanti controllo -->
    <div class="water-buttons">
      <button class="water-btn" id="waterMinus" title="Diminuisci acqua" aria-label="Diminuisci livello acqua">−</button>
      <button class="water-btn" id="waterPlus" title="Aumenta acqua" aria-label="Aumenta livello acqua">+</button>
    </div>
  </div>

   <!-- Toast message verde per il successo -->
  <div id="success-toast" role="alert" aria-live="polite" style="display:none;">
    <span class="toast-icon" aria-hidden="true">
      <svg viewBox="0 0 24 24" fill="none" stroke="#4caf50" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
        <path d="M9 12l2 2 4-4"/>
        <circle cx="12" cy="12" r="10"/>
      </svg>
    </span>
    <span class="toast-msg">
      <b>Complimenti!</b> Oggi sei riuscito a bere 2,5L di acqua e questo ti aiuterà a stare molto meglio. Buona vita!
    </span>
    <button class="toast-close" title="Chiudi" aria-label="Chiudi" onclick="javascript:hideSuccessToast()">&times;</button>
  </div>

   <!-- Container per i coriandoli -->
  <div id="confettiContainer" class="confetti-container" style="display: none;"></div>

  <!-- Audio per la vittoria -->
  <audio id="victorySound" preload="auto">
    <source src="victory.mp3" type="audio/mpeg">
     <!-- <source src="victory.wav" type="audio/wav"> -->
  </audio>

  <!-- Toast per lo swipe -->
  <div id="swipe-toast"></div>

  <!-- Footer -->
  <footer class="footer">
    Made with 
    <svg class="heart-icon" viewBox="0 0 24 24" width="16" height="16" fill="currentColor">
      <path d="M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35z"/>
    </svg>
    and AI
  </footer>

</body>
</html>
